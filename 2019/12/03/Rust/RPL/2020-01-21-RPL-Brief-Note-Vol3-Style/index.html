<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  
  <meta name="description" content="AI | NLP | 人工智能 | 哲学 | 自然语言处理 | 机器学习" />
  

  
  
  
  
  
  <title>The Rust Programming Language Brief Note (Vol3-Style) | Yam</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="13 Functional Language Features Iterators and Closures13-1 Closures Anonymous Functions13-1-1 Creating an Abstraction of Behavior with Closures13-1-2 Closure Type Inference and Annotation13-1-3 Storin">
<meta name="keywords" content="Rust">
<meta property="og:type" content="article">
<meta property="og:title" content="The Rust Programming Language Brief Note (Vol3-Style)">
<meta property="og:url" content="https://www.yam.gift/2019/12/03/Rust/RPL/2020-01-21-RPL-Brief-Note-Vol3-Style/index.html">
<meta property="og:site_name" content="Yam">
<meta property="og:description" content="13 Functional Language Features Iterators and Closures13-1 Closures Anonymous Functions13-1-1 Creating an Abstraction of Behavior with Closures13-1-2 Closure Type Inference and Annotation13-1-3 Storin">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2021-07-06T13:03:58.860Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="The Rust Programming Language Brief Note (Vol3-Style)">
<meta name="twitter:description" content="13 Functional Language Features Iterators and Closures13-1 Closures Anonymous Functions13-1-1 Creating an Abstraction of Behavior with Closures13-1-2 Closure Type Inference and Annotation13-1-3 Storin">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css">
  

  
  <!-- baidu webmaster push -->
<link rel="alternate" href="/atom.xml" title="Yam" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body class="home blog custom-background custom-font-enabled single-author">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="page" class="hfeed site">
      <header id="masthead" class="site-header" role="banner">
    <hgroup>
      <h1 class="site-title">
        <a href="/" title="Yam" rel="home">Yam</a>
      </h1>
      
        <h2 class="site-description">
          <a href="/" id="subtitle">Feeling, Coding, Thinking</a>
        </h2>
      
    </hgroup>

    <nav id="site-navigation" class="main-navigation" role="navigation">
            <button class="menu-toggle">菜单</button>
            <a class="assistive-text" href="/#content" title="跳至内容">跳至内容</a><!--TODO-->
            <div class="menu-main-container">
                <ul id="menu-main" class="nav-menu">
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/">Home</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/series/">Series</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/archives/">Archives</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="/about/">About</a></li>
                
                    <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="https://github.com/hscspring">Projects</a></li>
                
                </ul>
            </div>
    </nav>
</header>
      <div id="main" class="wrapper">
        <div id="primary" class="site-content"><div id="content" role="main"><article id="post-Rust/RPL/2020-01-21-RPL-Brief-Note-Vol3-Style" class="post-Rust/RPL/2020-01-21-RPL-Brief-Note-Vol3-Style post type-post status-publish format-standard hentry">
    <!---->

      <header class="entry-header">
        
        
  
    <h1 class="entry-title article-title">
      The Rust Programming Language Brief Note (Vol3-Style)
    </h1>
  

        
        <!-- <div class="comments-link">
            
            <a href="javascript:void(0);" data-url="https://www.yam.gift/2019/12/03/Rust/RPL/2020-01-21-RPL-Brief-Note-Vol3-Style/" data-id="ckx1vldsy0116p8bzyvebt38s" class="leave-reply bdsharebuttonbox" data-cmd="more">undefined</a>
        </div> --><!-- .comments-link -->
      </header><!-- .entry-header -->

    <div class="entry-content">
      
            <!-- Table of Contents -->
              
        <div class="toc"><ul class="toc-item"><li><span><a href="#13-Functional-Language-Features-Iterators-and-Closures" data-toc-modified-id="13-Functional-Language-Features-Iterators-and-Closures-1">13 Functional Language Features Iterators and Closures</a></span><ul class="toc-item"><li><span><a href="#13-1-Closures-Anonymous-Functions" data-toc-modified-id="13-1-Closures-Anonymous-Functions-1.1">13-1 Closures Anonymous Functions</a></span><ul class="toc-item"><li><span><a href="#13-1-1-Creating-an-Abstraction-of-Behavior-with-Closures" data-toc-modified-id="13-1-1-Creating-an-Abstraction-of-Behavior-with-Closures-1.1.1">13-1-1 Creating an Abstraction of Behavior with Closures</a></span></li><li><span><a href="#13-1-2-Closure-Type-Inference-and-Annotation" data-toc-modified-id="13-1-2-Closure-Type-Inference-and-Annotation-1.1.2">13-1-2 Closure Type Inference and Annotation</a></span></li><li><span><a href="#13-1-3-Storing-Closures-Using-Generic-Parameters-and-the-Fn-Traits" data-toc-modified-id="13-1-3-Storing-Closures-Using-Generic-Parameters-and-the-Fn-Traits-1.1.3">13-1-3 Storing Closures Using Generic Parameters and the <code>Fn</code> Traits</a></span></li><li><span><a href="#13-1-4-Limitations-of-the-Cacher-Implementation" data-toc-modified-id="13-1-4-Limitations-of-the-Cacher-Implementation-1.1.4">13-1-4 Limitations of the <code>Cacher</code> Implementation</a></span></li><li><span><a href="#13-1-5-Capturing-the-Environment-with-Closures" data-toc-modified-id="13-1-5-Capturing-the-Environment-with-Closures-1.1.5">13-1-5 Capturing the Environment with Closures</a></span></li></ul></li><li><span><a href="#13-2-Processing-a-Series-of-Items-with-Iterators" data-toc-modified-id="13-2-Processing-a-Series-of-Items-with-Iterators-1.2">13-2 Processing a Series of Items with Iterators</a></span><ul class="toc-item"><li><span><a href="#13-2-1-The-Iterator-Trait-and-the-Next-Method" data-toc-modified-id="13-2-1-The-Iterator-Trait-and-the-Next-Method-1.2.1">13-2-1 The <code>Iterator</code> Trait and the <code>Next</code> Method</a></span></li><li><span><a href="#13-2-2-Methods-that-Consume-the-Iterator" data-toc-modified-id="13-2-2-Methods-that-Consume-the-Iterator-1.2.2">13-2-2 Methods that Consume the Iterator</a></span></li><li><span><a href="#13-2-3-Methods-that-Produce-Other-Iterators" data-toc-modified-id="13-2-3-Methods-that-Produce-Other-Iterators-1.2.3">13-2-3 Methods that Produce Other Iterators</a></span></li><li><span><a href="#13-2-4-Using-Closures-that-Capture-Their-Environment" data-toc-modified-id="13-2-4-Using-Closures-that-Capture-Their-Environment-1.2.4">13-2-4 Using Closures that Capture Their Environment</a></span></li><li><span><a href="#13-2-5-Creating-Our-Own-Iterators-with-the-Iterator-Trait" data-toc-modified-id="13-2-5-Creating-Our-Own-Iterators-with-the-Iterator-Trait-1.2.5">13-2-5 Creating Our Own Iterators with the <code>Iterator</code> Trait</a></span><ul class="toc-item"><li><span><a href="#13-2-5-1-Using-Our-Counter-Iterator's-next-method" data-toc-modified-id="13-2-5-1-Using-Our-Counter-Iterator's-next-method-1.2.5.1">13-2-5-1 Using Our <code>Counter</code> Iterator's <code>next</code> method</a></span></li><li><span><a href="#13-2-5-2-Using-Other-Iterator-Trait-Methods" data-toc-modified-id="13-2-5-2-Using-Other-Iterator-Trait-Methods-1.2.5.2">13-2-5-2 Using Other <code>Iterator</code> Trait Methods</a></span></li></ul></li></ul></li><li><span><a href="#13-3-Improving-Our-IO-Project" data-toc-modified-id="13-3-Improving-Our-IO-Project-1.3">13-3 Improving Our IO Project</a></span><ul class="toc-item"><li><span><a href="#13-3-1-Removing-a-clone-Using-an-Iterator" data-toc-modified-id="13-3-1-Removing-a-clone-Using-an-Iterator-1.3.1">13-3-1 Removing a <code>clone</code> Using an Iterator</a></span><ul class="toc-item"><li><span><a href="#13-3-1-1-Using-the-Returned-Iterator-Directly" data-toc-modified-id="13-3-1-1-Using-the-Returned-Iterator-Directly-1.3.1.1">13-3-1-1 Using the Returned Iterator Directly</a></span></li><li><span><a href="#13-3-1-2-Using-Iterator-Trait-Methods-Instead-of-Indexing" data-toc-modified-id="13-3-1-2-Using-Iterator-Trait-Methods-Instead-of-Indexing-1.3.1.2">13-3-1-2 Using <code>Iterator</code> Trait Methods Instead of Indexing</a></span></li></ul></li><li><span><a href="#13-3-2-Making-Code-Clearer-with-Iterator-Adaptors" data-toc-modified-id="13-3-2-Making-Code-Clearer-with-Iterator-Adaptors-1.3.2">13-3-2 Making Code Clearer with Iterator Adaptors</a></span></li></ul></li><li><span><a href="#13.4-Comparing-Performance:-Loop-vs.-Iterators" data-toc-modified-id="13.4-Comparing-Performance:-Loop-vs.-Iterators-1.4">13.4 Comparing Performance: Loop vs. Iterators</a></span></li></ul></li><li><span><a href="#17-Object-Oriented-Programming-Features-of-Rust" data-toc-modified-id="17-Object-Oriented-Programming-Features-of-Rust-2">17 Object Oriented Programming Features of Rust</a></span><ul class="toc-item"><li><span><a href="#17-1-Characteristics-of-Object-Oriented-Languages" data-toc-modified-id="17-1-Characteristics-of-Object-Oriented-Languages-2.1">17-1 Characteristics of Object-Oriented Languages</a></span><ul class="toc-item"><li><span><a href="#17-1-1-Objects-Contain-Data-and-Behavior" data-toc-modified-id="17-1-1-Objects-Contain-Data-and-Behavior-2.1.1">17-1-1 Objects Contain Data and Behavior</a></span></li><li><span><a href="#17-1-2-Encapsulation-that-Hides-Implementation-Details" data-toc-modified-id="17-1-2-Encapsulation-that-Hides-Implementation-Details-2.1.2">17-1-2 Encapsulation that Hides Implementation Details</a></span></li><li><span><a href="#17-1-3-Inheritance-as-a-Type-System-and-as-Code-Sharing" data-toc-modified-id="17-1-3-Inheritance-as-a-Type-System-and-as-Code-Sharing-2.1.3">17-1-3 Inheritance as a Type System and as Code Sharing</a></span></li></ul></li><li><span><a href="#17-2-Using-Trait-Objects-That-Allows-for-Values-of-Different-Types" data-toc-modified-id="17-2-Using-Trait-Objects-That-Allows-for-Values-of-Different-Types-2.2">17-2 Using Trait Objects That Allows for Values of Different Types</a></span><ul class="toc-item"><li><span><a href="#17-2-1-Defining-a-Trait-for-Common-Behavior" data-toc-modified-id="17-2-1-Defining-a-Trait-for-Common-Behavior-2.2.1">17-2-1 Defining a Trait for Common Behavior</a></span></li><li><span><a href="#17-2-2-Implementing-the-Trait" data-toc-modified-id="17-2-2-Implementing-the-Trait-2.2.2">17-2-2 Implementing the Trait</a></span></li><li><span><a href="#17-2-3-Trait-Objects-Perform-Dynamic-Dispatch" data-toc-modified-id="17-2-3-Trait-Objects-Perform-Dynamic-Dispatch-2.2.3">17-2-3 Trait Objects Perform Dynamic Dispatch</a></span></li><li><span><a href="#17-2-4-Object-Safety-Is-Required-for-Trait-Objects" data-toc-modified-id="17-2-4-Object-Safety-Is-Required-for-Trait-Objects-2.2.4">17-2-4 Object Safety Is Required for Trait Objects</a></span></li></ul></li><li><span><a href="#17-3-Implementing-an-Object-Oriented-Design-Pattern" data-toc-modified-id="17-3-Implementing-an-Object-Oriented-Design-Pattern-2.3">17-3 Implementing an Object-Oriented Design Pattern</a></span><ul class="toc-item"><li><span><a href="#17-3-1-Defining-Post-and-Creating-a-New-Instance-in-the-Draft-State" data-toc-modified-id="17-3-1-Defining-Post-and-Creating-a-New-Instance-in-the-Draft-State-2.3.1">17-3-1 Defining <code>Post</code> and Creating a New Instance in the Draft State</a></span></li><li><span><a href="#17-3-2-Storing-the-Text-of-the-Post-Content" data-toc-modified-id="17-3-2-Storing-the-Text-of-the-Post-Content-2.3.2">17-3-2 Storing the Text of the Post Content</a></span></li><li><span><a href="#17-3-3-Ensuring-the-Content-of-a-Draft-Post-Is-Empty" data-toc-modified-id="17-3-3-Ensuring-the-Content-of-a-Draft-Post-Is-Empty-2.3.3">17-3-3 Ensuring the Content of a Draft Post Is Empty</a></span></li><li><span><a href="#17-3-4-Requesting-a-Review-of-the-Post-Changes-Its-State" data-toc-modified-id="17-3-4-Requesting-a-Review-of-the-Post-Changes-Its-State-2.3.4">17-3-4 Requesting a Review of the Post Changes Its State</a></span></li><li><span><a href="#17-3-5-Adding-the-approve-Method-that-Changes-the-Behavior-of-content" data-toc-modified-id="17-3-5-Adding-the-approve-Method-that-Changes-the-Behavior-of-content-2.3.5">17-3-5 Adding the <code>approve</code> Method that Changes the Behavior of <code>content</code></a></span></li><li><span><a href="#17-3-6-Trade-offs-of-the-State-Pattern" data-toc-modified-id="17-3-6-Trade-offs-of-the-State-Pattern-2.3.6">17-3-6 Trade-offs of the State Pattern</a></span><ul class="toc-item"><li><span><a href="#17-3-6-1-Encoding-States-and-Behavior-as-Types" data-toc-modified-id="17-3-6-1-Encoding-States-and-Behavior-as-Types-2.3.6.1">17-3-6-1 Encoding States and Behavior as Types</a></span></li><li><span><a href="#17-3-6-2-Implementing-Transitions-as-Transformations-into-Different-Types" data-toc-modified-id="17-3-6-2-Implementing-Transitions-as-Transformations-into-Different-Types-2.3.6.2">17-3-6-2 Implementing Transitions as Transformations into Different Types</a></span></li></ul></li></ul></li></ul></li></ul></div>

<a id="more"></a>
<h2 id="13-Functional-Language-Features-Iterators-and-Closures"><a href="#13-Functional-Language-Features-Iterators-and-Closures" class="headerlink" title="13 Functional Language Features Iterators and Closures"></a>13 Functional Language Features Iterators and Closures</h2><h3 id="13-1-Closures-Anonymous-Functions"><a href="#13-1-Closures-Anonymous-Functions" class="headerlink" title="13-1 Closures Anonymous Functions"></a>13-1 Closures Anonymous Functions</h3><p>Rust’s closures are anonymous functions you can save in a variable or pass as arguments to other functions. We want to define code in one place in our program, but only <em>execute</em> that code where we actually need the result. This is a use case for closures!</p>
<h4 id="13-1-1-Creating-an-Abstraction-of-Behavior-with-Closures"><a href="#13-1-1-Creating-an-Abstraction-of-Behavior-with-Closures" class="headerlink" title="13-1-1 Creating an Abstraction of Behavior with Closures"></a>13-1-1 Creating an Abstraction of Behavior with Closures</h4><p>We can define a closure and store the <em>closure</em> in a variable rather than storing the result of the function call:</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">generate_workout</span></span>(intensity: <span class="keyword">u32</span>, random_number: <span class="keyword">u32</span>) &#123;</span><br><span class="line">    <span class="comment">// do not excute here</span></span><br><span class="line">    <span class="keyword">let</span> expensive_closure = |num| &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"calculating slowly..."</span>);</span><br><span class="line">        thread::sleep(Duration::from_secs(<span class="number">2</span>));</span><br><span class="line">        num</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> intensity &lt; <span class="number">25</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">"Today, do &#123;&#125; pushups!"</span>,</span><br><span class="line">            expensive_closure(intensity)</span><br><span class="line">        );</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">"Next, do &#123;&#125; situps!"</span>,</span><br><span class="line">            expensive_closure(intensity)</span><br><span class="line">        );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> random_number == <span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"Take a break today! Remember to stay hydrated!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(</span><br><span class="line">                <span class="string">"Today, run for &#123;&#125; minutes!"</span>,</span><br><span class="line">                expensive_closure(intensity)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that this <code>let</code> statement means <code>expensive_closure</code> contains the <em>definition</em> of an anonymous function, not the <em>resulting value</em> of calling the anonymous function. </p>
<p>Now the expensive calculation is called in only one place, and we’re only executing that code where we need the results. </p>
<p>However, we’re still calling the closure twice in the first <code>if</code> block, which will call the expensive code twice and make the user wait twice as long as they need to.</p>
<h4 id="13-1-2-Closure-Type-Inference-and-Annotation"><a href="#13-1-2-Closure-Type-Inference-and-Annotation" class="headerlink" title="13-1-2 Closure Type Inference and Annotation"></a>13-1-2 Closure Type Inference and Annotation</h4><p>Closures don’t require you to annotate the types of the parameters or the return value like <code>fn</code> functions do. Type annotations are required on functions because they’re part of an explicit interface exposed to your users.  Defining this interface rigidly is important for ensuring that everyone agrees on what types of values a function uses and returns. But closures aren’t used in an exposed interface like this: they’re stored in variables and used without naming them and exposing them to users of our library.</p>
<h4 id="13-1-3-Storing-Closures-Using-Generic-Parameters-and-the-Fn-Traits"><a href="#13-1-3-Storing-Closures-Using-Generic-Parameters-and-the-Fn-Traits" class="headerlink" title="13-1-3 Storing Closures Using Generic Parameters and the Fn Traits"></a>13-1-3 Storing Closures Using Generic Parameters and the <code>Fn</code> Traits</h4><p>For the problem (still calling the closure twice in the first <code>if</code> block) before, we can create a struct that will hold the closure and the resulting value of calling the closure. The struct will execute the closure only if we need the resulting value, and it will cache the resulting value so the rest of our code doesn’t have to be responsible for saving and reusing the result. You may know this pattern as <em>memoization</em> or <em>lazy evaluation</em>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Cacher</span></span>&lt;T&gt;</span><br><span class="line">    <span class="keyword">where</span> T: <span class="built_in">Fn</span>(<span class="keyword">u32</span>) -&gt; <span class="keyword">u32</span></span><br><span class="line">&#123;</span><br><span class="line">    calculation: T,</span><br><span class="line">    value: <span class="built_in">Option</span>&lt;<span class="keyword">u32</span>&gt;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>Cacher</code> struct has a <code>calculation</code> field of the generic type <code>T</code>. The trait bounds on <code>T</code> specify that it’s a closure by using the <code>Fn</code> trait. Any closure we want to store in the <code>calculation</code> field must have one <code>u32</code> parameter (specified within the parentheses after <code>Fn</code>) and must return a <code>u32</code>(specified after the <code>-&gt;</code>).</p>
<p>The <code>value</code> field is of type <code>Option&lt;u32&gt;</code>. Before we execute the closure, <code>value</code> will be <code>None</code>. When code using a <code>Cacher</code> asks for the <em>result</em> of the closure, the <code>Cacher</code> will execute the closure at that time and store the result within a <code>Some</code> variant in the <code>value</code> field. Then if the code asks for the result of the closure again, instead of executing the closure again, the <code>Cacher</code> will return the result held in the <code>Some</code> variant.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span>&lt;T&gt; Cacher&lt;T&gt;</span><br><span class="line">    <span class="keyword">where</span> T: <span class="built_in">Fn</span>(<span class="keyword">u32</span>) -&gt; <span class="keyword">u32</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(calculation: T) -&gt; Cacher&lt;T&gt; &#123;</span><br><span class="line">        Cacher &#123;</span><br><span class="line">            calculation,</span><br><span class="line">            value: <span class="literal">None</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">value</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, arg: <span class="keyword">u32</span>) -&gt; <span class="keyword">u32</span> &#123;</span><br><span class="line">        <span class="keyword">match</span> <span class="keyword">self</span>.value &#123;</span><br><span class="line">            <span class="literal">Some</span>(v) =&gt; v,</span><br><span class="line">            <span class="literal">None</span> =&gt; &#123;</span><br><span class="line">                <span class="keyword">let</span> v = (<span class="keyword">self</span>.calculation)(arg);</span><br><span class="line">                <span class="keyword">self</span>.value = <span class="literal">Some</span>(v);</span><br><span class="line">                v</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">generate_workout</span></span>(intensity: <span class="keyword">u32</span>, random_number: <span class="keyword">u32</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> expensive_result = Cacher::new(|num| &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">"calculating slowly..."</span>);</span><br><span class="line">        thread::sleep(Duration::from_secs(<span class="number">2</span>));</span><br><span class="line">        num</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> intensity &lt; <span class="number">25</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">"Today, do &#123;&#125; pushups!"</span>,</span><br><span class="line">            expensive_result.value(intensity)</span><br><span class="line">        );</span><br><span class="line">        <span class="built_in">println!</span>(</span><br><span class="line">            <span class="string">"Next, do &#123;&#125; situps!"</span>,</span><br><span class="line">            expensive_result.value(intensity)</span><br><span class="line">        );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> random_number == <span class="number">3</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(<span class="string">"Take a break today! Remember to stay hydrated!"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">println!</span>(</span><br><span class="line">                <span class="string">"Today, run for &#123;&#125; minutes!"</span>,</span><br><span class="line">                expensive_result.value(intensity)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Instead of saving the closure in a variable directly, we save a new instance of <code>Cacher</code> that holds the closure. Then, in each place we want the result, we call the <code>value</code> method on the <code>Cacher</code> instance. We can call the <code>value</code> method as many times as we want, or not call it at all, and the expensive calculation will be run a maximum of once.</p>
<h4 id="13-1-4-Limitations-of-the-Cacher-Implementation"><a href="#13-1-4-Limitations-of-the-Cacher-Implementation" class="headerlink" title="13-1-4 Limitations of the Cacher Implementation"></a>13-1-4 Limitations of the <code>Cacher</code> Implementation</h4><p>The first problem is that a <code>Cacher</code> instance assumes it will always get the same value for the parameter <code>arg</code> to the <code>value</code> method. Try modifying <code>Cacher</code> to hold a hash map rather than a single value. The keys of the hash map will be the <code>arg</code> values that are passed in, and the values of the hash map will be the result of calling the closure on that key. Instead of looking at whether <code>self.value</code> directly has a <code>Some</code> or a <code>None</code> value, the <code>value</code> function will look up the <code>arg</code> in the hash map and return the value if it’s present. If it’s not present, the <code>Cacher</code> will call the closure and save the resulting value in the hash map associated with its <code>arg</code> value.</p>
<p>The second problem with the current <code>Cacher</code> implementation is that it only accepts closures that take one parameter of type <code>u32</code> and return a <code>u32</code>. We might want to cache the results of closures that take a string slice and return <code>usize</code> values, for example. To fix this issue, try introducing more generic parameters to increase the flexibility of the <code>Cacher</code> functionality.</p>
<h4 id="13-1-5-Capturing-the-Environment-with-Closures"><a href="#13-1-5-Capturing-the-Environment-with-Closures" class="headerlink" title="13-1-5 Capturing the Environment with Closures"></a>13-1-5 Capturing the Environment with Closures</h4><p>Closures have an additional capability that functions don’t have: <strong>they can capture their environment and access variables from the scope in which they’re defined.</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> equal_to_x = |z| z == x;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> y = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert!</span>(equal_to_x(y));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="number">4</span>;</span><br><span class="line">	<span class="comment">// function</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">equal_to_x</span></span>(z: <span class="keyword">i32</span>) -&gt; <span class="keyword">bool</span> &#123; z == x &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> y = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert!</span>(equal_to_x(y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// can't capture dynamic environment in a fn item; use the || &#123; ...&#125; closure form instead</span></span><br></pre></td></tr></table></figure>
<p>Closures can capture values from their environment in three ways, which directly map to the three ways a function can take a parameter: taking ownership, borrowing mutably, and borrowing immutably. These are encoded in the three <code>Fn</code> traits as follows:</p>
<ul>
<li><code>FnOnce</code> consumes the variables it captures from its enclosing scope, known as the closure’s <em>environment</em>. To consume the captured variables, the closure must take ownership of these variables and move them into the closure when it is defined. The <code>Once</code> part of the name represents the fact that the closure can’t take ownership of the same variables more than once, so it can be called only once.</li>
<li><code>FnMut</code> can change the environment because it mutably borrows values.</li>
<li><code>Fn</code> borrows values from the environment immutably.</li>
</ul>
<p>When you create a closure, Rust infers which trait to use based on how the closure uses the values from the environment. All closures implement <code>FnOnce</code> because they can all be called at least once. Closures that don’t move the captured variables also implement <code>FnMut</code>, and closures that don’t need mutable access to the captured variables also implement <code>Fn</code>. </p>
<p>If you want to force the closure to take ownership of the values it uses in the environment, you can use the <code>move</code> keyword before the parameter list. This technique is mostly useful when passing a closure to a new thread to move the data so it’s owned by the new thread.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> x = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> equal_to_x = <span class="keyword">move</span> |z| z == x;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">"can't use x here: &#123;:?&#125;"</span>, x);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> y = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert!</span>(equal_to_x(y));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>x</code> value is moved into the closure when the closure is defined, because we added the <code>move</code> keyword. The closure then has ownership of <code>x</code>, and <code>main</code> isn’t allowed to use <code>x</code> anymore in the <code>println!</code> statement. Removing <code>println!</code> will fix this example.</p>
<p>Most of the time when specifying one of the <code>Fn</code> trait bounds, you can start with <code>Fn</code> and the compiler will tell you if you need <code>FnMut</code> or <code>FnOnce</code> based on what happens in the closure body.</p>
<h3 id="13-2-Processing-a-Series-of-Items-with-Iterators"><a href="#13-2-Processing-a-Series-of-Items-with-Iterators" class="headerlink" title="13-2 Processing a Series of Items with Iterators"></a>13-2 Processing a Series of Items with Iterators</h3><p>In Rust, iterators are <em>lazy</em>, meaning they have no effect until you call methods that consume the iterator to use it up. </p>
<h4 id="13-2-1-The-Iterator-Trait-and-the-Next-Method"><a href="#13-2-1-The-Iterator-Trait-and-the-Next-Method" class="headerlink" title="13-2-1 The Iterator Trait and the Next Method"></a>13-2-1 The <code>Iterator</code> Trait and the <code>Next</code> Method</h4><p>All iterators implement a trait named <code>Iterator</code> that is defined in the standard library.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Iterator</span></span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Item</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">next</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; <span class="built_in">Option</span>&lt;Self::Item&gt;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// methods with default implementations elided</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">iterator_demonstration</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> v1 = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> v1_iter = v1.iter();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(v1_iter.next(), <span class="literal">Some</span>(&amp;<span class="number">1</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(v1_iter.next(), <span class="literal">Some</span>(&amp;<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(v1_iter.next(), <span class="literal">Some</span>(&amp;<span class="number">3</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(v1_iter.next(), <span class="literal">None</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that we needed to make <code>v1_iter</code> mutable: calling the <code>next</code> method on an iterator changes internal state that the iterator uses to keep track of where it is in the sequence. In other words, this code <em>consumes</em>, or uses up, the iterator. Each call to <code>next</code> eats up an item from the iterator. We didn’t need to make <code>v1_iter</code> mutable when we used a <code>for</code> loop because the loop took ownership of <code>v1_iter</code> and made it mutable behind the scenes.</p>
<p>Also note that the values we get from the calls to <code>next</code> are immutable references to the values in the vector. The <code>iter</code> method produces an iterator over immutable references. </p>
<ul>
<li>If we want to create an iterator that takes ownership of <code>v1</code> and returns owned values, we can call <code>into_iter</code> instead of <code>iter</code>. </li>
<li>Similarly, if we want to iterate over mutable references, we can call <code>iter_mut</code> instead of <code>iter</code>.</li>
</ul>
<h4 id="13-2-2-Methods-that-Consume-the-Iterator"><a href="#13-2-2-Methods-that-Consume-the-Iterator" class="headerlink" title="13-2-2 Methods that Consume the Iterator"></a>13-2-2 Methods that Consume the Iterator</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">iterator_sum</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> v1 = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> v1_iter = v1.iter();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> total: <span class="keyword">i32</span> = v1_iter.sum();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(total, <span class="number">6</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We aren’t allowed to use <code>v1_iter</code> after the call to <code>sum</code> because <code>sum</code> takes ownership of the iterator we call it on.</p>
<h4 id="13-2-3-Methods-that-Produce-Other-Iterators"><a href="#13-2-3-Methods-that-Produce-Other-Iterators" class="headerlink" title="13-2-3 Methods that Produce Other Iterators"></a>13-2-3 Methods that Produce Other Iterators</h4><p>Other methods defined on the <code>Iterator</code> trait, known as <em>iterator adaptors</em>, allow you to change iterators into different kinds of iterators. You can chain multiple calls to iterator adaptors to perform complex actions in a readable way. But because all iterators are lazy, you have to call one of the consuming adaptor methods to get results from calls to iterator adaptors.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v1: <span class="built_in">Vec</span>&lt;<span class="keyword">i32</span>&gt; = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">v1.iter().map(|x| x + <span class="number">1</span>);</span><br><span class="line"><span class="comment">// warning: unused `std::iter::Map` which must be used: iterator adaptors are lazy and do nothing unless consumed</span></span><br></pre></td></tr></table></figure>
<p>This code doesn’t do anything; the closure we’ve specified never gets called. The warning reminds us why: iterator adaptors are lazy, and we need to consume the iterator here.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> v1: <span class="built_in">Vec</span>&lt;<span class="keyword">i32</span>&gt; = <span class="built_in">vec!</span>[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> v2: <span class="built_in">Vec</span>&lt;_&gt; = v1.iter().map(|x| x + <span class="number">1</span>).collect();</span><br><span class="line"></span><br><span class="line"><span class="built_in">assert_eq!</span>(v2, <span class="built_in">vec!</span>[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line"><span class="comment">// collect consumes the iterator and collects the resulting values into a collection data type.</span></span><br></pre></td></tr></table></figure>
<p>Because <code>map</code> takes a closure, we can specify any operation we want to perform on each item. This is a great example of how closures let you customize some behavior while reusing the iteration behavior that the <code>Iterator</code> trait provides.</p>
<h4 id="13-2-4-Using-Closures-that-Capture-Their-Environment"><a href="#13-2-4-Using-Closures-that-Capture-Their-Environment" class="headerlink" title="13-2-4 Using Closures that Capture Their Environment"></a>13-2-4 Using Closures that Capture Their Environment</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[derive(PartialEq, Debug)]</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Shoe</span></span> &#123;</span><br><span class="line">    size: <span class="keyword">u32</span>,</span><br><span class="line">    style: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">shoes_in_my_size</span></span>(shoes: <span class="built_in">Vec</span>&lt;Shoe&gt;, shoe_size: <span class="keyword">u32</span>) -&gt; <span class="built_in">Vec</span>&lt;Shoe&gt; &#123;</span><br><span class="line">    <span class="comment">// filter to adapt that iterator </span></span><br><span class="line">    shoes.into_iter()</span><br><span class="line">        .filter(|s| s.size == shoe_size)</span><br><span class="line">        .collect()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">filters_by_size</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> shoes = <span class="built_in">vec!</span>[</span><br><span class="line">        Shoe &#123; size: <span class="number">10</span>, style: <span class="built_in">String</span>::from(<span class="string">"sneaker"</span>) &#125;,</span><br><span class="line">        Shoe &#123; size: <span class="number">13</span>, style: <span class="built_in">String</span>::from(<span class="string">"sandal"</span>) &#125;,</span><br><span class="line">        Shoe &#123; size: <span class="number">10</span>, style: <span class="built_in">String</span>::from(<span class="string">"boot"</span>) &#125;,</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> in_my_size = shoes_in_my_size(shoes, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(</span><br><span class="line">        in_my_size,</span><br><span class="line">        <span class="built_in">vec!</span>[</span><br><span class="line">            Shoe &#123; size: <span class="number">10</span>, style: <span class="built_in">String</span>::from(<span class="string">"sneaker"</span>) &#125;,</span><br><span class="line">            Shoe &#123; size: <span class="number">10</span>, style: <span class="built_in">String</span>::from(<span class="string">"boot"</span>) &#125;,</span><br><span class="line">        ]</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The closure captures the <code>shoe_size</code> parameter from the environment and compares the value with each shoe’s size, keeping only shoes of the size specified. </p>
<h4 id="13-2-5-Creating-Our-Own-Iterators-with-the-Iterator-Trait"><a href="#13-2-5-Creating-Our-Own-Iterators-with-the-Iterator-Trait" class="headerlink" title="13-2-5 Creating Our Own Iterators with the Iterator Trait"></a>13-2-5 Creating Our Own Iterators with the <code>Iterator</code> Trait</h4><p>You can create iterators that do anything you want by implementing the <code>Iterator</code> trait on your own types. As previously mentioned, the only method you’re required to provide a definition for is the <code>next</code> method. Once you’ve done that, you can use all other methods that have default implementations provided by the <code>Iterator</code> trait!</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Counter</span></span> &#123;</span><br><span class="line">    count: <span class="keyword">u32</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Counter &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; Counter &#123;</span><br><span class="line">        Counter &#123; count: <span class="number">0</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> <span class="built_in">Iterator</span> <span class="keyword">for</span> Counter &#123;</span><br><span class="line">    <span class="class"><span class="keyword">type</span> <span class="title">Item</span></span> = <span class="keyword">u32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">next</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; <span class="built_in">Option</span>&lt;Self::Item&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span>.count += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>.count &lt; <span class="number">6</span> &#123;</span><br><span class="line">            <span class="literal">Some</span>(<span class="keyword">self</span>.count)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="13-2-5-1-Using-Our-Counter-Iterator’s-next-method"><a href="#13-2-5-1-Using-Our-Counter-Iterator’s-next-method" class="headerlink" title="13-2-5-1 Using Our Counter Iterator’s next method"></a>13-2-5-1 Using Our <code>Counter</code> Iterator’s <code>next</code> method</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">calling_next_directly</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> counter = Counter::new();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(counter.next(), <span class="literal">Some</span>(<span class="number">1</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(counter.next(), <span class="literal">Some</span>(<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(counter.next(), <span class="literal">Some</span>(<span class="number">3</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(counter.next(), <span class="literal">Some</span>(<span class="number">4</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(counter.next(), <span class="literal">Some</span>(<span class="number">5</span>));</span><br><span class="line">    <span class="built_in">assert_eq!</span>(counter.next(), <span class="literal">None</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="13-2-5-2-Using-Other-Iterator-Trait-Methods"><a href="#13-2-5-2-Using-Other-Iterator-Trait-Methods" class="headerlink" title="13-2-5-2 Using Other Iterator Trait Methods"></a>13-2-5-2 Using Other <code>Iterator</code> Trait Methods</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[test]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">using_other_iterator_trait_methods</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> sum: <span class="keyword">u32</span> = Counter::new().zip(Counter::new().skip(<span class="number">1</span>))</span><br><span class="line">                                 .map(|(a, b)| a * b)</span><br><span class="line">                                 .filter(|x| x % <span class="number">3</span> == <span class="number">0</span>)</span><br><span class="line">                                 .sum();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="number">18</span>, sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Note that <code>zip</code> produces only four pairs; the theoretical fifth pair <code>(5, None)</code> is never produced because <code>zip</code> returns <code>None</code> when either of its input iterators return <code>None</code>.</p>
<h3 id="13-3-Improving-Our-IO-Project"><a href="#13-3-Improving-Our-IO-Project" class="headerlink" title="13-3 Improving Our IO Project"></a>13-3 Improving Our IO Project</h3><h4 id="13-3-1-Removing-a-clone-Using-an-Iterator"><a href="#13-3-1-Removing-a-clone-Using-an-Iterator" class="headerlink" title="13-3-1 Removing a clone Using an Iterator"></a>13-3-1 Removing a <code>clone</code> Using an Iterator</h4><p>The IO project can be found <a href="https://github.com/hscspring/Coding-Collections/tree/master/Rust/minigrep" target="_blank" rel="noopener">here</a>, <code>clone</code> is used to make the <code>Config</code> own the values.</p>
<p>Here we change the <code>new</code> function to take ownership of an iterator as its argument instead of borrowing a slice.</p>
<h5 id="13-3-1-1-Using-the-Returned-Iterator-Directly"><a href="#13-3-1-1-Using-the-Returned-Iterator-Directly" class="headerlink" title="13-3-1-1 Using the Returned Iterator Directly"></a>13-3-1-1 Using the Returned Iterator Directly</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// modify the src/main.rs</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">	<span class="keyword">let</span> config = Config::new(env::args()).unwrap_or_else(|err| &#123;</span><br><span class="line">        eprintln!(<span class="string">"Problem parsing arguments: &#123;&#125;"</span>, err);</span><br><span class="line">        process::exit(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>env::args()</code> function returns an iterator! Rather than collecting the iterator values into a vector and then passing a slice to <code>Config::new</code>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// update src/lib.rs</span></span><br><span class="line"><span class="keyword">impl</span> Config &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(<span class="keyword">mut</span> args: std::env::Args) -&gt; <span class="built_in">Result</span>&lt;Config, &amp;<span class="symbol">'static</span> <span class="keyword">str</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// --snip--</span></span><br></pre></td></tr></table></figure>
<p>The standard library documentation for the <code>env::args</code> function shows that the type of the iterator it returns is <code>std::env::Args</code>. Because we’re taking ownership of <code>args</code> and we’ll be mutating <code>args</code> by iterating over it, we can add the <code>mut</code> keyword into the specification of the <code>args</code> parameter to make it mutable.</p>
<h5 id="13-3-1-2-Using-Iterator-Trait-Methods-Instead-of-Indexing"><a href="#13-3-1-2-Using-Iterator-Trait-Methods-Instead-of-Indexing" class="headerlink" title="13-3-1-2 Using Iterator Trait Methods Instead of Indexing"></a>13-3-1-2 Using <code>Iterator</code> Trait Methods Instead of Indexing</h5><p>The standard library documentation also mentions that <code>std::env::Args</code> implements the <code>Iterator</code> trait, so we know we can call the <code>next</code> method on it!</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> Config &#123;</span><br><span class="line">	<span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>(<span class="keyword">mut</span> args: std::env::Args) -&gt; <span class="built_in">Result</span>&lt;Config, &amp;<span class="symbol">'static</span> <span class="keyword">str</span>&gt; &#123;</span><br><span class="line">        <span class="comment">// the first value in the return value of env::args is the name of the program.</span></span><br><span class="line">    	args.next();</span><br><span class="line">        <span class="keyword">let</span> query = <span class="keyword">match</span> args.next() &#123;</span><br><span class="line">        	<span class="literal">Some</span>(arg) =&gt; arg,</span><br><span class="line">            <span class="literal">None</span> =&gt; <span class="keyword">return</span> <span class="literal">Err</span>(<span class="string">"Didn't get a query string"</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">let</span> filename = <span class="keyword">match</span> args.next() &#123;</span><br><span class="line">        	<span class="literal">Some</span>(arg) =&gt; arg,</span><br><span class="line">            <span class="literal">None</span> =&gt; <span class="keyword">return</span> <span class="literal">Err</span>(<span class="string">"Didn't get a file name"</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">let</span> case_sensitive = env::var(<span class="string">"CASE_INSENSITIVE"</span>).is_err();</span><br><span class="line">        <span class="literal">Ok</span>(Config &#123;query, filename, case_sensitive&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="13-3-2-Making-Code-Clearer-with-Iterator-Adaptors"><a href="#13-3-2-Making-Code-Clearer-with-Iterator-Adaptors" class="headerlink" title="13-3-2 Making Code Clearer with Iterator Adaptors"></a>13-3-2 Making Code Clearer with Iterator Adaptors</h4><p>We can write the <code>search</code> code in a more concise way using iterator adaptor methods. Doing so also lets us avoid having a mutable intermediate <code>results</code> vector. The functional programming style prefers to minimize the amount of mutable state to make code clearer. Removing the mutable state might enable a future enhancement to make searching happen in parallel, because we wouldn’t have to manage concurrent access to the <code>results</code> vector. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">search</span></span>&lt;<span class="symbol">'a</span>&gt;(query: &amp;<span class="keyword">str</span>, contents: &amp;<span class="symbol">'a</span> <span class="keyword">str</span>) -&gt; <span class="built_in">Vec</span>&lt;&amp;<span class="symbol">'a</span> <span class="keyword">str</span>&gt; &#123;</span><br><span class="line">	contents.lines()</span><br><span class="line">    	.filter(|line| line.contains(query))</span><br><span class="line">    	.collect()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="13-4-Comparing-Performance-Loop-vs-Iterators"><a href="#13-4-Comparing-Performance-Loop-vs-Iterators" class="headerlink" title="13.4 Comparing Performance: Loop vs. Iterators"></a>13.4 Comparing Performance: Loop vs. Iterators</h3><p>The iterator version was slightly faster! The point is this: iterators, although a high-level abstraction, get compiled down to roughly the same code as if you’d written the lower-level code yourself. Iterators are one of Rust’s <em>zero-cost abstractions</em>.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// another example</span></span><br><span class="line"><span class="keyword">let</span> buffer: &amp;<span class="keyword">mut</span> [<span class="keyword">i32</span>];</span><br><span class="line"><span class="keyword">let</span> coefficients: [<span class="keyword">i64</span>; <span class="number">12</span>];</span><br><span class="line"><span class="keyword">let</span> qlp_shift: <span class="keyword">i16</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">12</span>..buffer.len() &#123;</span><br><span class="line">    <span class="keyword">let</span> prediction = coefficients.iter()</span><br><span class="line">                                 .zip(&amp;buffer[i - <span class="number">12</span>..i])</span><br><span class="line">                                 .map(|(&amp;c, &amp;s)| c * s <span class="keyword">as</span> <span class="keyword">i64</span>)</span><br><span class="line">                                 .sum::&lt;<span class="keyword">i64</span>&gt;() &gt;&gt; qlp_shift;</span><br><span class="line">    <span class="keyword">let</span> delta = buffer[i];</span><br><span class="line">    buffer[i] = prediction <span class="keyword">as</span> <span class="keyword">i32</span> + delta;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>There’s no loop at all corresponding to the iteration over the values in <code>coefficients</code>: Rust knows that there are 12 iterations, so it “unrolls” the loop. <em>Unrolling</em> is an optimization that removes the overhead of the loop controlling code and instead generates repetitive code for each iteration of the loop.</p>
<p>You can use iterators and closures without fear! They make code seem like it’s higher level but don’t impose a runtime performance penalty for doing so.</p>
<h2 id="17-Object-Oriented-Programming-Features-of-Rust"><a href="#17-Object-Oriented-Programming-Features-of-Rust" class="headerlink" title="17 Object Oriented Programming Features of Rust"></a>17 Object Oriented Programming Features of Rust</h2><h3 id="17-1-Characteristics-of-Object-Oriented-Languages"><a href="#17-1-Characteristics-of-Object-Oriented-Languages" class="headerlink" title="17-1 Characteristics of Object-Oriented Languages"></a>17-1 Characteristics of Object-Oriented Languages</h3><h4 id="17-1-1-Objects-Contain-Data-and-Behavior"><a href="#17-1-1-Objects-Contain-Data-and-Behavior" class="headerlink" title="17-1-1 Objects Contain Data and Behavior"></a>17-1-1 Objects Contain Data and Behavior</h4><p>Rust is object oriented: structs and enums have data, and <code>impl</code> blocks provide methods on structs and enums.</p>
<h4 id="17-1-2-Encapsulation-that-Hides-Implementation-Details"><a href="#17-1-2-Encapsulation-that-Hides-Implementation-Details" class="headerlink" title="17-1-2 Encapsulation that Hides Implementation Details"></a>17-1-2 Encapsulation that Hides Implementation Details</h4><p>Rust uses the <code>pub</code> keyword to decide which modules, types, functions, and methods in our code should be public, and by default everything else is private. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">AveragedCollection</span></span> &#123;</span><br><span class="line">    list: <span class="built_in">Vec</span>&lt;<span class="keyword">i32</span>&gt;,</span><br><span class="line">    average: <span class="keyword">f64</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The struct is marked <code>pub</code> so that other code can use it, but the fields within the struct remain private. </p>
<p>This is important in this case because we want to ensure that whenever a value is added or removed from the list, the average is also updated. We do this by implementing <code>add</code>, <code>remove</code>, and <code>average</code> methods on the struct.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">imple AveragedCollection &#123;</span><br><span class="line">	<span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">add</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, value: <span class="keyword">i32</span>) &#123;</span><br><span class="line">    	<span class="keyword">self</span>.list.push(value);</span><br><span class="line">        <span class="keyword">self</span>.update_average();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">remove</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) -&gt; <span class="built_in">Option</span>&lt;<span class="keyword">i32</span>&gt; &#123;</span><br><span class="line">    	<span class="keyword">let</span> result = <span class="keyword">self</span>.list.pop();</span><br><span class="line">        <span class="keyword">match</span> result &#123;</span><br><span class="line">        	<span class="literal">Some</span>(value) =&gt; &#123;</span><br><span class="line">            	<span class="keyword">self</span>.update_average();</span><br><span class="line">                <span class="literal">Some</span>(value);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="literal">None</span> =&gt; <span class="literal">None</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">average</span></span>(&amp;<span class="keyword">self</span>) -&gt; <span class="keyword">f64</span> &#123;</span><br><span class="line">    	<span class="keyword">self</span>.average</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">update_average</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">    	<span class="keyword">let</span> total: <span class="keyword">i32</span> = <span class="keyword">self</span>.list.iter().sum();</span><br><span class="line">        <span class="keyword">self</span>.average = total <span class="keyword">as</span> <span class="keyword">f64</span> / <span class="keyword">self</span>.list.len() <span class="keyword">as</span> <span class="keyword">f64</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The public methods <code>add</code>, <code>remove</code>, and <code>average</code> are the only ways to access or modify data in an instance of <code>AveragedCollection</code>. </p>
<p>We leave the <code>list</code> and <code>average</code> fields private so there is no way for external code to add or remove items to the <code>list</code> field directly; otherwise, the <code>average</code> field might become out of sync when the <code>list</code> changes. The <code>average</code> method returns the value in the <code>average</code> field, allowing external code to read the <code>average</code> but not modify it.</p>
<h4 id="17-1-3-Inheritance-as-a-Type-System-and-as-Code-Sharing"><a href="#17-1-3-Inheritance-as-a-Type-System-and-as-Code-Sharing" class="headerlink" title="17-1-3 Inheritance as a Type System and as Code Sharing"></a>17-1-3 Inheritance as a Type System and as Code Sharing</h4><p>If a language must have inheritance to be an object-oriented language, then Rust is not one. There is no way to define a struct that inherits the parent struct’s fields and method implementations. However you can use other solutions in Rust, depending on your reason for reaching for inheritance in the first place.</p>
<p>You choose inheritance for two main reasons. </p>
<ul>
<li>One is for reuse of code: you can implement particular behavior for one type, and inheritance enables you to reuse that implementation for a different type. You can share Rust code using default trait method implementations instead.</li>
<li>The other reason to use inheritance relates to the type system: to enable a child type to be used in the same places as the parent type. This is also called <em>polymorphism</em>, which means that you can substitute multiple objects for each other at runtime if they share certain characteristics. Rust instead uses generics to abstract over different possible types and trait bounds to impose constraints on what those types must provide. This is sometimes called <em>bounded parametric polymorphism</em>.</li>
</ul>
<h3 id="17-2-Using-Trait-Objects-That-Allows-for-Values-of-Different-Types"><a href="#17-2-Using-Trait-Objects-That-Allows-for-Values-of-Different-Types" class="headerlink" title="17-2 Using Trait Objects That Allows for Values of Different Types"></a>17-2 Using Trait Objects That Allows for Values of Different Types</h3><p>We could define an enum that had variants to hold different types, so a vector could store different types of data in each cell.</p>
<p>The case: In a language with inheritance, we might define a class named <code>Component</code> that has a method named <code>draw</code> on it. The other classes, such as <code>Button</code>, <code>Image</code>, and <code>SelectBox</code>, would inherit from <code>Component</code> and thus inherit the <code>draw</code> method. They could each override the <code>draw</code> method to define their custom behavior, but the framework could treat all of the types as if they were <code>Component</code> instances and call <code>draw</code> on them. </p>
<h4 id="17-2-1-Defining-a-Trait-for-Common-Behavior"><a href="#17-2-1-Defining-a-Trait-for-Common-Behavior" class="headerlink" title="17-2-1 Defining a Trait for Common Behavior"></a>17-2-1 Defining a Trait for Common Behavior</h4><p>Trait objects <em>are</em> more like objects in other languages in the sense that they combine data and behavior. But trait objects differ from traditional objects in that we can’t add data to a trait object. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">trait</span> <span class="title">Draw</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">draw</span></span>(&amp;<span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Next, this vector is of type <code>Box</code>, which is a trait object; it’s a stand-in for any type inside a <code>Box</code> that implements the <code>Draw</code> trait.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Screen</span></span> &#123;</span><br><span class="line">	<span class="keyword">pub</span> components: <span class="built_in">Vec</span>&lt;<span class="built_in">Box</span>&lt;dyn Draw&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Screen &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">run</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> component <span class="keyword">in</span> <span class="keyword">self</span>.components.iter() &#123;</span><br><span class="line">            component.draw();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This works differently from defining a struct that uses a generic type parameter with trait bounds. <strong>A generic type parameter can only be substituted with one concrete type at a time, whereas trait objects allow for multiple concrete types to fill in for the trait object at runtime.</strong> For example, we could have defined the <code>Screen</code> struct using a generic type and a trait bound.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Screen</span></span>&lt;T: Draw&gt; &#123;</span><br><span class="line">    <span class="keyword">pub</span> components: <span class="built_in">Vec</span>&lt;T&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span>&lt;T&gt; Screen&lt;T&gt;</span><br><span class="line">    <span class="keyword">where</span> T: Draw &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">run</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> component <span class="keyword">in</span> <span class="keyword">self</span>.components.iter() &#123;</span><br><span class="line">            component.draw();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This restricts us to a <code>Screen</code> instance that has a list of components all of type <code>Button</code> or all of type <code>TextField</code>. If you’ll only ever have homogeneous collections, using generics and trait bounds is preferable because the definitions will be monomorphized at compile time to use the concrete types.</p>
<p>On the other hand, with the method using trait objects, one <code>Screen</code> instance can hold a <code>Vec</code> that contains a <code>Box&lt;Button&gt;</code> as well as a <code>Box&lt;TextField&gt;</code>. </p>
<h4 id="17-2-2-Implementing-the-Trait"><a href="#17-2-2-Implementing-the-Trait" class="headerlink" title="17-2-2 Implementing the Trait"></a>17-2-2 Implementing the Trait</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Button</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> width: <span class="keyword">u32</span>,</span><br><span class="line">    <span class="keyword">pub</span> height: <span class="keyword">u32</span>,</span><br><span class="line">    <span class="keyword">pub</span> label: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Draw <span class="keyword">for</span> Button &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">draw</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="comment">// code to actually draw a button</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> gui::Draw;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SelectBox</span></span> &#123;</span><br><span class="line">    width: <span class="keyword">u32</span>,</span><br><span class="line">    height: <span class="keyword">u32</span>,</span><br><span class="line">    options: <span class="built_in">Vec</span>&lt;<span class="built_in">String</span>&gt;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Draw <span class="keyword">for</span> SelectBox &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">draw</span></span>(&amp;<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="comment">// code to actually draw a select box</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Our library’s user can now write their <code>main</code> function to create a <code>Screen</code> instance. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> gui::&#123;Screen, Button&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> screen = Screen &#123;</span><br><span class="line">        components: <span class="built_in">vec!</span>[</span><br><span class="line">            <span class="built_in">Box</span>::new(SelectBox &#123;</span><br><span class="line">                width: <span class="number">75</span>,</span><br><span class="line">                height: <span class="number">10</span>,</span><br><span class="line">                options: <span class="built_in">vec!</span>[</span><br><span class="line">                    <span class="built_in">String</span>::from(<span class="string">"Yes"</span>),</span><br><span class="line">                    <span class="built_in">String</span>::from(<span class="string">"Maybe"</span>),</span><br><span class="line">                    <span class="built_in">String</span>::from(<span class="string">"No"</span>)</span><br><span class="line">                ],</span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="built_in">Box</span>::new(Button &#123;</span><br><span class="line">                width: <span class="number">50</span>,</span><br><span class="line">                height: <span class="number">10</span>,</span><br><span class="line">                label: <span class="built_in">String</span>::from(<span class="string">"OK"</span>),</span><br><span class="line">            &#125;),</span><br><span class="line">        ],</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    screen.run();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The code can be found <a href="https://github.com/hscspring/Coding-Collections/tree/master/Rust/gui" target="_blank" rel="noopener">here</a>.</p>
<p>When we wrote the library, we didn’t know that someone might add the <code>SelectBox</code> type, but our <code>Screen</code> implementation was able to operate on the new type and draw it because <code>SelectBox</code> implements the <code>Draw</code> trait, which means it implements the <code>draw</code> method.</p>
<p>This concept—of being concerned only with the messages a value responds to rather than the value’s concrete type—is similar to the concept <em>duck typing</em> in dynamically typed languages: if it walks like a duck and quacks like a duck, then it must be a duck! In the implementation of <code>run</code> on <code>Screen</code>, <code>run</code> doesn’t need to know what the concrete type of each component is. It doesn’t check whether a component is an instance of a <code>Button</code> or a <code>SelectBox</code>, it just calls the <code>draw</code> method on the component. By specifying <code>Box</code> as the type of the values in the <code>components</code> vector, we’ve defined <code>Screen</code> to need values that we can call the <code>draw</code> method on.</p>
<p>The advantage of using trait objects and Rust’s type system to write code similar to code using duck typing is that we never have to check whether a value implements a particular method at runtime or worry about getting errors if a value doesn’t implement a method but we call it anyway. </p>
<h4 id="17-2-3-Trait-Objects-Perform-Dynamic-Dispatch"><a href="#17-2-3-Trait-Objects-Perform-Dynamic-Dispatch" class="headerlink" title="17-2-3 Trait Objects Perform Dynamic Dispatch"></a>17-2-3 Trait Objects Perform Dynamic Dispatch</h4><p>When we use trait objects, Rust must use dynamic dispatch. </p>
<ul>
<li>The compiler doesn’t know all the types that might be used with the code that is using trait objects, so it doesn’t know which method implemented on which type to call. </li>
<li>Instead, at runtime, Rust uses the pointers inside the trait object to know which method to call. There is a runtime cost when this lookup happens that doesn’t occur with static dispatch. </li>
<li>Dynamic dispatch also prevents the compiler from choosing to inline a method’s code, which in turn prevents some optimizations. </li>
</ul>
<h4 id="17-2-4-Object-Safety-Is-Required-for-Trait-Objects"><a href="#17-2-4-Object-Safety-Is-Required-for-Trait-Objects" class="headerlink" title="17-2-4 Object Safety Is Required for Trait Objects"></a>17-2-4 Object Safety Is Required for Trait Objects</h4><p>You can only make <em>object-safe</em> traits into trait objects. A trait is object safe if all the methods defined in the trait have the following properties:</p>
<ul>
<li>The return type isn’t <code>Self</code></li>
<li>There are no generic type parameters</li>
</ul>
<p>Trait objects must be object safe because once you’ve used a trait object, Rust no longer knows the concrete type that’s implementing that trait. </p>
<ul>
<li>If a trait method returns the concrete <code>Self</code> type, but a trait object forgets the exact type that <code>Self</code> is, there is no way the method can use the original concrete type. </li>
<li>The same is true of generic type parameters that are filled in with concrete type parameters when the trait is used: the concrete types become part of the type that implements the trait. When the type is forgotten through the use of a trait object, there is no way to know what types to fill in the generic type parameters with.</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Screen</span></span> &#123;</span><br><span class="line">    <span class="keyword">pub</span> components: <span class="built_in">Vec</span>&lt;<span class="built_in">Box</span>&lt;dyn <span class="built_in">Clone</span>&gt;&gt;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// error[E0038]: the trait `std::clone::Clone` cannot be made into an object</span></span><br></pre></td></tr></table></figure>
<p>This error means you can’t use this trait as a trait object in this way. </p>
<h3 id="17-3-Implementing-an-Object-Oriented-Design-Pattern"><a href="#17-3-Implementing-an-Object-Oriented-Design-Pattern" class="headerlink" title="17-3 Implementing an Object-Oriented Design Pattern"></a>17-3 Implementing an Object-Oriented Design Pattern</h3><p>The <em>state pattern</em> is an object-oriented design pattern. The crux of the pattern is that a value has some internal state, which is represented by a set of <em>state objects</em>, and the value’s behavior changes based on the internal state. </p>
<p>We’ll implement a blog post workflow in an incremental way. The blog’s final functionality will look like this:</p>
<ol>
<li>A blog post starts as an empty draft.</li>
<li>When the draft is done, a review of the post is requested.</li>
<li>When the post is approved, it gets published.</li>
<li>Only published blog posts return content to print, so unapproved posts can’t accidentally be published.</li>
</ol>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> blog::Post;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> post = Post::new();</span><br><span class="line"></span><br><span class="line">    post.add_text(<span class="string">"I ate a salad for lunch today"</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="string">""</span>, post.content());</span><br><span class="line"></span><br><span class="line">    post.request_review();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="string">""</span>, post.content());</span><br><span class="line"></span><br><span class="line">    post.approve();</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="string">"I ate a salad for lunch today"</span>, post.content());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Notice that the only type we’re interacting with from the crate is the <code>Post</code> type. </p>
<ul>
<li>This type will use the state pattern and will hold a value that will be one of three state objects representing the various states a post can be in—draft, waiting for review, or published. </li>
<li>Changing from one state to another will be managed internally within the <code>Post</code> type. The states change in response to the methods called by our library’s users on the <code>Post</code> instance, but they don’t have to manage the state changes directly. </li>
<li>Also, users can’t make a mistake with the states, like publishing a post before it’s reviewed.</li>
</ul>
<h4 id="17-3-1-Defining-Post-and-Creating-a-New-Instance-in-the-Draft-State"><a href="#17-3-1-Defining-Post-and-Creating-a-New-Instance-in-the-Draft-State" class="headerlink" title="17-3-1 Defining Post and Creating a New Instance in the Draft State"></a>17-3-1 Defining <code>Post</code> and Creating a New Instance in the Draft State</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Post</span></span> &#123;</span><br><span class="line">    state: <span class="built_in">Option</span>&lt;<span class="built_in">Box</span>&lt;dyn State&gt;&gt;,</span><br><span class="line">    content: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Post &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; Post &#123;</span><br><span class="line">        Post &#123;</span><br><span class="line">            state: <span class="literal">Some</span>(<span class="built_in">Box</span>::new(Draft &#123;&#125;)),</span><br><span class="line">            content: <span class="built_in">String</span>::new(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">State</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Draft</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> State <span class="keyword">for</span> Draft &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>State</code> trait defines the behavior shared by different post states, and the <code>Draft</code>, <code>PendingReview</code>, and <code>Published</code> states will all implement the <code>State</code> trait. </p>
<p>When we create a new <code>Post</code>, we set its <code>state</code> field to a <code>Some</code> value that holds a <code>Box</code>. This <code>Box</code> points to a new instance of the <code>Draft</code> struct. This ensures whenever we create a new instance of <code>Post</code>, it will start out as a draft. Because the <code>state</code> field of <code>Post</code> is private, there is no way to create a <code>Post</code> in any other state!</p>
<h4 id="17-3-2-Storing-the-Text-of-the-Post-Content"><a href="#17-3-2-Storing-the-Text-of-the-Post-Content" class="headerlink" title="17-3-2 Storing the Text of the Post Content"></a>17-3-2 Storing the Text of the Post Content</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> Post &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">add_text</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, text: &amp;<span class="keyword">str</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.content.push_str(text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This behavior doesn’t depend on the state the post is in, so it’s not part of the state pattern. </p>
<h4 id="17-3-3-Ensuring-the-Content-of-a-Draft-Post-Is-Empty"><a href="#17-3-3-Ensuring-the-Content-of-a-Draft-Post-Is-Empty" class="headerlink" title="17-3-3 Ensuring the Content of a Draft Post Is Empty"></a>17-3-3 Ensuring the Content of a Draft Post Is Empty</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> Post &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">content</span></span>(&amp;<span class="keyword">self</span>) -&gt; &amp;<span class="keyword">str</span> &#123;</span><br><span class="line">        <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Adding a placeholder implementation for the <code>content</code> method on <code>Post</code> that always returns an empty string slice.</p>
<h4 id="17-3-4-Requesting-a-Review-of-the-Post-Changes-Its-State"><a href="#17-3-4-Requesting-a-Review-of-the-Post-Changes-Its-State" class="headerlink" title="17-3-4 Requesting a Review of the Post Changes Its State"></a>17-3-4 Requesting a Review of the Post Changes Its State</h4><p>Add functionality to request a review of a post, which should change its state from <code>Draft</code> to <code>PendingReview</code>. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> Post &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">request_review</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Some</span>(s) = <span class="keyword">self</span>.state.take() &#123;</span><br><span class="line">            <span class="keyword">self</span>.state = <span class="literal">Some</span>(s.request_review())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">State</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">request_review</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;dyn State&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Draft</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> State <span class="keyword">for</span> Draft &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">request_review</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;dyn State&gt; &#123;</span><br><span class="line">        <span class="built_in">Box</span>::new(PendingReview &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PendingReview</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> State <span class="keyword">for</span> PendingReview &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">request_review</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;dyn State&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="17-3-5-Adding-the-approve-Method-that-Changes-the-Behavior-of-content"><a href="#17-3-5-Adding-the-approve-Method-that-Changes-the-Behavior-of-content" class="headerlink" title="17-3-5 Adding the approve Method that Changes the Behavior of content"></a>17-3-5 Adding the <code>approve</code> Method that Changes the Behavior of <code>content</code></h4><p>It will set <code>state</code> to the value that the current state says it should have when that state is approved.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> Post &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">approve</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> <span class="literal">Some</span>(s) = <span class="keyword">self</span>.state.take() &#123;</span><br><span class="line">            <span class="keyword">self</span>.state = <span class="literal">Some</span>(s.approve())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">State</span></span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">request_review</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;dyn State&gt;;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">approve</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;dyn State&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Draft</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> State <span class="keyword">for</span> Draft &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">approve</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;dyn State&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PendingReview</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> State <span class="keyword">for</span> PendingReview &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">approve</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;dyn State&gt; &#123;</span><br><span class="line">        <span class="built_in">Box</span>::new(Published &#123;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Published</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> State <span class="keyword">for</span> Published &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">request_review</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;dyn State&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">approve</span></span>(<span class="keyword">self</span>: <span class="built_in">Box</span>&lt;<span class="keyword">Self</span>&gt;) -&gt; <span class="built_in">Box</span>&lt;dyn State&gt; &#123;</span><br><span class="line">        <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Because the goal is to keep all these rules inside the structs that implement <code>State</code>, we call a <code>content</code> method on the value in <code>state</code> and pass the post instance (that is, <code>self</code>) as an argument. Then we return the value that is returned from using the <code>content</code> method on the <code>state</code> value.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> Post &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">content</span></span>(&amp;<span class="keyword">self</span>) -&gt; &amp;<span class="keyword">str</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.state.as_ref().unwrap().content(<span class="keyword">self</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We call the <code>as_ref</code> method on the <code>Option</code> because we want a reference to the value inside the <code>Option</code> rather than ownership of the value. Because <code>state</code> is an <code>&lt;Option&gt;</code>, when we call <code>as_ref</code>, an <code>Option&lt;&amp;Box&gt;</code> is returned. If we didn’t call <code>as_ref</code>, we would get an error because we can’t move <code>state</code> out of the borrowed <code>&amp;self</code> of the function parameter.</p>
<p>We then call the <code>unwrap</code> method, which we know will never panic, because we know the methods on <code>Post</code> ensure that <code>state</code> will always contain a <code>Some</code> value when those methods are done. A <code>None</code> value is never possible, even though the compiler isn’t able to understand that.</p>
<p>At this point, when we call <code>content</code> on the <code>&amp;Box</code>, deref coercion will take effect on the <code>&amp;</code> and the <code>Box</code> so the <code>content</code> method will ultimately be called on the type that implements the <code>State</code> trait. That means we need to add <code>content</code> to the <code>State</code> trait definition.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">State</span></span> &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">content</span></span>&lt;<span class="symbol">'a</span>&gt;(&amp;<span class="keyword">self</span>, post: &amp;<span class="symbol">'a</span> Post) -&gt; &amp;<span class="symbol">'a</span> <span class="keyword">str</span> &#123;</span><br><span class="line">        <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// --snip--</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Published</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> State <span class="keyword">for</span> Published &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line">    <span class="function"><span class="keyword">fn</span> <span class="title">content</span></span>&lt;<span class="symbol">'a</span>&gt;(&amp;<span class="keyword">self</span>, post: &amp;<span class="symbol">'a</span> Post) -&gt; &amp;<span class="symbol">'a</span> <span class="keyword">str</span> &#123;</span><br><span class="line">        &amp;post.content</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>We add a default implementation for the <code>content</code> method that returns an empty string slice. That means we don’t need to implement <code>content</code> on the <code>Draft</code> and <code>PendingReview</code> structs. The <code>Published</code> struct will override the <code>content</code> method and return the value in <code>post.content</code>.</p>
<p>Note that we need lifetime annotations on this method. We’re taking a reference to a <code>post</code> as an argument and returning a reference to part of that <code>post</code>, so the lifetime of the returned reference is related to the lifetime of the <code>post</code> argument.</p>
<p>The code can be found <a href="https://github.com/hscspring/Coding-Collections/tree/master/Rust/blog" target="_blank" rel="noopener">here</a>.</p>
<h4 id="17-3-6-Trade-offs-of-the-State-Pattern"><a href="#17-3-6-Trade-offs-of-the-State-Pattern" class="headerlink" title="17-3-6 Trade-offs of the State Pattern"></a>17-3-6 Trade-offs of the State Pattern</h4><p>Rust is capable of implementing the object-oriented state pattern to encapsulate the different kinds of behavior a post should have in each state. The methods on <code>Post</code> know nothing about the various behaviors. </p>
<p>If we were to create an alternative implementation that didn’t use the state pattern, we might instead use <code>match</code> expressions in the methods on <code>Post</code> or even in the <code>main</code> code that checks the state of the post and changes behavior in those places. That would mean we would have to look in several places to understand all the implications of a post being in the published state! This would only increase the more states we added: each of those <code>match</code> expressions would need another arm.</p>
<p>With the state pattern, the <code>Post</code> methods and the places we use <code>Post</code> don’t need <code>match</code> expressions, and to add a new state, we would only need to add a new struct and implement the trait methods on that one struct.</p>
<p>One downside of the state pattern is that, because the states implement the transitions between states, some of the states are coupled to each other.</p>
<p>Another downside is that we’ve duplicated some logic. To eliminate some of the duplication, we might try to make default implementations for the <code>request_review</code> and <code>approve</code> methods on the <code>State</code> trait that return <code>self</code>; however, this would violate object safety, because the trait doesn’t know what the concrete <code>self</code> will be exactly. We want to be able to use <code>State</code> as a trait object, so we need its methods to be object safe.</p>
<h5 id="17-3-6-1-Encoding-States-and-Behavior-as-Types"><a href="#17-3-6-1-Encoding-States-and-Behavior-as-Types" class="headerlink" title="17-3-6-1 Encoding States and Behavior as Types"></a>17-3-6-1 Encoding States and Behavior as Types</h5><p>Rather than encapsulating the states and transitions completely so outside code has no knowledge of them, we’ll encode the states into different types. Consequently, Rust’s type checking system will prevent attempts to use draft posts where only published posts are allowed by issuing a compiler error.</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> post = Post::new();</span><br><span class="line"></span><br><span class="line">    post.add_text(<span class="string">"I ate a salad for lunch today"</span>);</span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="string">""</span>, post.content());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Instead of having a <code>content</code> method on a draft post that returns an empty string, we’ll make it so draft posts don’t have the <code>content</code> method at all. </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">Post</span></span> &#123;</span><br><span class="line">    content: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">DraftPost</span></span> &#123;</span><br><span class="line">    content: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> Post &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">new</span></span>() -&gt; DraftPost &#123;</span><br><span class="line">        DraftPost &#123;</span><br><span class="line">            content: <span class="built_in">String</span>::new(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">content</span></span>(&amp;<span class="keyword">self</span>) -&gt; &amp;<span class="keyword">str</span> &#123;</span><br><span class="line">        &amp;<span class="keyword">self</span>.content</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> DraftPost &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">add_text</span></span>(&amp;<span class="keyword">mut</span> <span class="keyword">self</span>, text: &amp;<span class="keyword">str</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.content.push_str(text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Now the program ensures all posts start as draft posts, and draft posts don’t have their content available for display. Any attempt to get around these constraints will result in a compiler error.</p>
<h5 id="17-3-6-2-Implementing-Transitions-as-Transformations-into-Different-Types"><a href="#17-3-6-2-Implementing-Transitions-as-Transformations-into-Different-Types" class="headerlink" title="17-3-6-2 Implementing Transitions as Transformations into Different Types"></a>17-3-6-2 Implementing Transitions as Transformations into Different Types</h5><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> DraftPost &#123;</span><br><span class="line">    <span class="comment">// --snip--</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">request_review</span></span>(<span class="keyword">self</span>) -&gt; PendingReviewPost &#123;</span><br><span class="line">        PendingReviewPost &#123;</span><br><span class="line">            content: <span class="keyword">self</span>.content,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="class"><span class="keyword">struct</span> <span class="title">PendingReviewPost</span></span> &#123;</span><br><span class="line">    content: <span class="built_in">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">impl</span> PendingReviewPost &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">approve</span></span>(<span class="keyword">self</span>) -&gt; Post &#123;</span><br><span class="line">        Post &#123;</span><br><span class="line">            content: <span class="keyword">self</span>.content,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The changes we needed to make to <code>main</code> to reassign <code>post</code> mean that this implementation doesn’t quite follow the object-oriented state pattern anymore: the transformations between the states are no longer encapsulated entirely within the <code>Post</code> implementation. However, our gain is that invalid states are now impossible because of the type system and the type checking that happens at compile time! </p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> blog::Post;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> post = Post::new();</span><br><span class="line"></span><br><span class="line">    post.add_text(<span class="string">"I ate a salad for lunch today"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> post = post.request_review();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> post = post.approve();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">assert_eq!</span>(<span class="string">"I ate a salad for lunch today"</span>, post.content());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The code can be found <a href="https://github.com/hscspring/Coding-Collections/tree/master/Rust/blog2" target="_blank" rel="noopener">here</a>.</p>

      
    </div><!-- .entry-content -->

    <footer class="entry-meta">
    <a href="/2019/12/03/Rust/RPL/2020-01-21-RPL-Brief-Note-Vol3-Style/">
    <time datetime="2019-12-03T04:00:00.000Z" class="entry-date">
        2019-12-03
    </time>
</a>
    
  <span class="article-delim">&#8226;</span>
  <div class="article-category">
  <a class="article-category-link" href="/categories/Coding/">Coding</a>
  </div>

    
  <span class="article-delim">&#8226;</span>
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rust/">Rust</a></li></ul>

    </footer>
</article>


    
<nav class="nav-single">
    <h3 class="assistive-text">文章导航</h3>
    
        <span class="nav-previous"><a href="/2019/12/03/Rust/RPL/2019-12-31-RPL-Brief-Note-Vol5-Project/" rel="prev"><span class="meta-nav">←</span> The Rust Programming Language Brief Note (Vol5-Project)</a></span>
    
    
        <span class="nav-next"><a href="/2019/12/03/Rust/RPL/2019-12-31-RPL-Brief-Note-Vol4-Advance/" rel="next">The Rust Programming Language Brief Note (Vol4-Advance) <span class="meta-nav">→</span></a></span>
    
</nav><!-- .nav-single -->







<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a><a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a><a href="#" class="bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_evernotecn" data-cmd="evernotecn" title="分享到印象笔记"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{},"image":{"viewList":["fbook","twi","linkedin","qzone","tsina","douban","weixin","evernotecn"],"viewText":"分享到：","viewSize":"16"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?'];</script>

<section id="comment">
  <!-- 评论代码 -->
  <div id="gitalk-container"></div>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
  <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  <script>
  const gitalk = new Gitalk({
    clientID: '0eb512031083d6e7edfb',
    clientSecret: 'e830808995dd813ca26fed50573760963457da37',
    repo: 'hscspring.github.io',
    owner: 'hscspring',
    admin: ['hscspring'],
    id: md5(location.pathname),
    distractionFreeMode: false
  })
  gitalk.render('gitalk-container')
  </script>
  <!-- 评论代码已完成 -->
</section>

</div></div>
        <div id="secondary" class="widget-area" role="complementary">
  
    
  <aside class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-content">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Coding/">Coding</a><span class="category-list-count">69</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Feeling/">Feeling</a><span class="category-list-count">88</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Thinking/">Thinking</a><span class="category-list-count">19</span></li></ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Music</h3>
    <div class="widget-content">
      <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=541131&auto=0&height=66"></iframe>
      <!-- 评论代码 -->
      <!-- <audio src="http://qnimg.lovevivian.cn/miss.mp3" controls="controls"
             style="width:100%">
        您的浏览器不支持 audio 标签。
      </audio> -->
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Recents</h3>
    <div class="widget-content">
      <ul>
        
          <li>
            <a href="/2021/12/26/Diary/2021-12-25-Lion-Dance/">《舞狮少年》观后——信念、文化与希望</a>
          </li>
        
          <li>
            <a href="/2021/12/25/Paper/2021-12-25-MLT-Promote/">Multitask Prompted Training Enables Zero-shot Task Generalization</a>
          </li>
        
          <li>
            <a href="/2021/12/19/Net/2021-12-19-VirtualNetwork/">虚拟网络指南</a>
          </li>
        
          <li>
            <a href="/2021/12/04/Paper/2021-12-04-Prompt/">Pretrain, Prompt and Predict, A Systematic Survey of Prompting Methods in NLP</a>
          </li>
        
          <li>
            <a href="/2021/11/28/Paper/2021-11-28-DataAugmentation/">Data Augmentation Approaches in Natural Language Processing：A Survey</a>
          </li>
        
      </ul>
    </div>
  </aside>

  
    
  <aside class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-content tagcloud">
      <a href="/tags/AE/" style="font-size: 10px;">AE</a> <a href="/tags/AI/" style="font-size: 19.09px;">AI</a> <a href="/tags/ALBERT/" style="font-size: 10px;">ALBERT</a> <a href="/tags/AR/" style="font-size: 10px;">AR</a> <a href="/tags/AUC/" style="font-size: 10px;">AUC</a> <a href="/tags/Accuracy/" style="font-size: 10px;">Accuracy</a> <a href="/tags/Activation/" style="font-size: 10px;">Activation</a> <a href="/tags/Algorithm/" style="font-size: 13.64px;">Algorithm</a> <a href="/tags/Array/" style="font-size: 10px;">Array</a> <a href="/tags/Arrow/" style="font-size: 10px;">Arrow</a> <a href="/tags/Attention/" style="font-size: 12.73px;">Attention</a> <a href="/tags/Automatic-Speech-Processing/" style="font-size: 10px;">Automatic Speech Processing</a> <a href="/tags/Automation/" style="font-size: 10px;">Automation</a> <a href="/tags/BERT/" style="font-size: 17.27px;">BERT</a> <a href="/tags/BPE/" style="font-size: 10px;">BPE</a> <a href="/tags/Backtracking/" style="font-size: 10px;">Backtracking</a> <a href="/tags/Backward/" style="font-size: 10px;">Backward</a> <a href="/tags/Bahdanau-Attention/" style="font-size: 10px;">Bahdanau Attention</a> <a href="/tags/Bart/" style="font-size: 10px;">Bart</a> <a href="/tags/Bayes/" style="font-size: 10px;">Bayes</a> <a href="/tags/Beam-Search/" style="font-size: 10px;">Beam Search</a> <a href="/tags/Bert-Flow/" style="font-size: 10px;">Bert-Flow</a> <a href="/tags/Bi-LSTM/" style="font-size: 10px;">Bi-LSTM</a> <a href="/tags/Biasing/" style="font-size: 10px;">Biasing</a> <a href="/tags/Binary-Search/" style="font-size: 11.82px;">Binary Search</a> <a href="/tags/Blending/" style="font-size: 10px;">Blending</a> <a href="/tags/Bridge/" style="font-size: 10px;">Bridge</a> <a href="/tags/Business/" style="font-size: 11.82px;">Business</a> <a href="/tags/C/" style="font-size: 10.91px;">C</a> <a href="/tags/CCG/" style="font-size: 10.91px;">CCG</a> <a href="/tags/CFG/" style="font-size: 10px;">CFG</a> <a href="/tags/CKY/" style="font-size: 10px;">CKY</a> <a href="/tags/CNN/" style="font-size: 10px;">CNN</a> <a href="/tags/CRF/" style="font-size: 10px;">CRF</a> <a href="/tags/CS/" style="font-size: 10px;">CS</a> <a href="/tags/CYK/" style="font-size: 10px;">CYK</a> <a href="/tags/Calculus/" style="font-size: 10px;">Calculus</a> <a href="/tags/Camera/" style="font-size: 10px;">Camera</a> <a href="/tags/Catalan/" style="font-size: 10px;">Catalan</a> <a href="/tags/ChatBot/" style="font-size: 10px;">ChatBot</a> <a href="/tags/Chi2/" style="font-size: 10px;">Chi2</a> <a href="/tags/Chunking/" style="font-size: 10px;">Chunking</a> <a href="/tags/Classification/" style="font-size: 10.91px;">Classification</a> <a href="/tags/Cognition/" style="font-size: 10.91px;">Cognition</a> <a href="/tags/Collaborative-Filtering/" style="font-size: 10px;">Collaborative Filtering</a> <a href="/tags/Collins-Parser/" style="font-size: 10px;">Collins Parser</a> <a href="/tags/Computational-Linguistics/" style="font-size: 10px;">Computational Linguistics</a> <a href="/tags/Computer/" style="font-size: 10px;">Computer</a> <a href="/tags/Computer-Science/" style="font-size: 12.73px;">Computer Science</a> <a href="/tags/Confusing-Labels/" style="font-size: 10px;">Confusing Labels</a> <a href="/tags/Context-Free-Grammars/" style="font-size: 10px;">Context-Free Grammars</a> <a href="/tags/Contrastive-Learning/" style="font-size: 10px;">Contrastive-Learning</a> <a href="/tags/Coordinate-Ascent/" style="font-size: 10px;">Coordinate Ascent</a> <a href="/tags/Cosine/" style="font-size: 10.91px;">Cosine</a> <a href="/tags/Cosine-Similarity/" style="font-size: 10px;">Cosine Similarity</a> <a href="/tags/Cross-Entropy/" style="font-size: 10px;">Cross Entropy</a> <a href="/tags/Cross-brackets/" style="font-size: 10px;">Cross-brackets</a> <a href="/tags/Ctrl/" style="font-size: 10px;">Ctrl</a> <a href="/tags/Culture/" style="font-size: 10px;">Culture</a> <a href="/tags/DA/" style="font-size: 10px;">DA</a> <a href="/tags/DB/" style="font-size: 10.91px;">DB</a> <a href="/tags/DNN/" style="font-size: 10px;">DNN</a> <a href="/tags/DP/" style="font-size: 10px;">DP</a> <a href="/tags/Data-Augmentation/" style="font-size: 10px;">Data Augmentation</a> <a href="/tags/Data-Clearing/" style="font-size: 10px;">Data Clearing</a> <a href="/tags/Data-Enhancement/" style="font-size: 10px;">Data Enhancement</a> <a href="/tags/Data-Preprocess/" style="font-size: 10px;">Data Preprocess</a> <a href="/tags/Data-Science/" style="font-size: 14.55px;">Data Science</a> <a href="/tags/Data-Structure/" style="font-size: 16.36px;">Data Structure</a> <a href="/tags/Database/" style="font-size: 10px;">Database</a> <a href="/tags/DeBERTa/" style="font-size: 10px;">DeBERTa</a> <a href="/tags/Debiasing/" style="font-size: 10px;">Debiasing</a> <a href="/tags/Decoder/" style="font-size: 10px;">Decoder</a> <a href="/tags/Decoding/" style="font-size: 10px;">Decoding</a> <a href="/tags/Deep/" style="font-size: 10px;">Deep</a> <a href="/tags/DeepGraph/" style="font-size: 10px;">DeepGraph</a> <a href="/tags/DeepLearning/" style="font-size: 12.73px;">DeepLearning</a> <a href="/tags/Dependence/" style="font-size: 10px;">Dependence</a> <a href="/tags/Diary/" style="font-size: 11.82px;">Diary</a> <a href="/tags/Disentangled-Attention/" style="font-size: 10px;">Disentangled Attention</a> <a href="/tags/DistilBERT/" style="font-size: 10px;">DistilBERT</a> <a href="/tags/Distillation/" style="font-size: 10px;">Distillation</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Docker-Compose/" style="font-size: 10px;">Docker-Compose</a> <a href="/tags/Dockerfile/" style="font-size: 10px;">Dockerfile</a> <a href="/tags/Dropout/" style="font-size: 10.91px;">Dropout</a> <a href="/tags/Dynamic-Mask/" style="font-size: 10px;">Dynamic-Mask</a> <a href="/tags/EDA/" style="font-size: 10px;">EDA</a> <a href="/tags/EMD/" style="font-size: 10px;">EMD</a> <a href="/tags/ERNIE/" style="font-size: 10px;">ERNIE</a> <a href="/tags/Economics/" style="font-size: 10px;">Economics</a> <a href="/tags/Edit-Distance/" style="font-size: 10px;">Edit Distance</a> <a href="/tags/Efficient-DeepLearning/" style="font-size: 10px;">Efficient-DeepLearning</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/Electra/" style="font-size: 10px;">Electra</a> <a href="/tags/Elixir/" style="font-size: 10.91px;">Elixir</a> <a href="/tags/Ellipsis/" style="font-size: 10px;">Ellipsis</a> <a href="/tags/Embedding/" style="font-size: 11.82px;">Embedding</a> <a href="/tags/Embeddings/" style="font-size: 10.91px;">Embeddings</a> <a href="/tags/Encoder/" style="font-size: 10px;">Encoder</a> <a href="/tags/Entropy/" style="font-size: 10.91px;">Entropy</a> <a href="/tags/Evaluation/" style="font-size: 10.91px;">Evaluation</a> <a href="/tags/F1/" style="font-size: 10px;">F1</a> <a href="/tags/FDW/" style="font-size: 10px;">FDW</a> <a href="/tags/FSM/" style="font-size: 10px;">FSM</a> <a href="/tags/Faith/" style="font-size: 10px;">Faith</a> <a href="/tags/Feature-Engineering/" style="font-size: 10px;">Feature Engineering</a> <a href="/tags/Feature-based/" style="font-size: 10px;">Feature-based</a> <a href="/tags/Few-Shot/" style="font-size: 10px;">Few-Shot</a> <a href="/tags/Fine-tuning/" style="font-size: 10px;">Fine-tuning</a> <a href="/tags/Formal-Grammars/" style="font-size: 11.82px;">Formal Grammars</a> <a href="/tags/Forward/" style="font-size: 10px;">Forward</a> <a href="/tags/Full-Text-Search/" style="font-size: 10px;">Full-Text-Search</a> <a href="/tags/Function-Syntax/" style="font-size: 10px;">Function Syntax</a> <a href="/tags/Funk-MF/" style="font-size: 10px;">Funk MF</a> <a href="/tags/Funnel-Transformer/" style="font-size: 10px;">Funnel Transformer</a> <a href="/tags/GBTD/" style="font-size: 10px;">GBTD</a> <a href="/tags/GELU/" style="font-size: 10px;">GELU</a> <a href="/tags/GPT-2/" style="font-size: 10px;">GPT-2</a> <a href="/tags/GPU/" style="font-size: 10px;">GPU</a> <a href="/tags/GRU/" style="font-size: 10px;">GRU</a> <a href="/tags/GSG/" style="font-size: 10px;">GSG</a> <a href="/tags/Gan/" style="font-size: 10px;">Gan</a> <a href="/tags/Garden-path/" style="font-size: 10px;">Garden-path</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Glow/" style="font-size: 10px;">Glow</a> <a href="/tags/Graceful-Shutdown/" style="font-size: 10px;">Graceful Shutdown</a> <a href="/tags/Gradient-Descent/" style="font-size: 10px;">Gradient Descent</a> <a href="/tags/Graph/" style="font-size: 10.91px;">Graph</a> <a href="/tags/GraphQL/" style="font-size: 10.91px;">GraphQL</a> <a href="/tags/Grid-Grammar/" style="font-size: 10px;">Grid Grammar</a> <a href="/tags/HMM/" style="font-size: 10.91px;">HMM</a> <a href="/tags/Hard-SVM/" style="font-size: 10px;">Hard-SVM</a> <a href="/tags/Hinge-Loss/" style="font-size: 10px;">Hinge Loss</a> <a href="/tags/Hope/" style="font-size: 10px;">Hope</a> <a href="/tags/Host-only/" style="font-size: 10px;">Host-only</a> <a href="/tags/IE/" style="font-size: 10px;">IE</a> <a href="/tags/IQR/" style="font-size: 10px;">IQR</a> <a href="/tags/Imbalance-Data/" style="font-size: 10px;">Imbalance Data</a> <a href="/tags/Industry/" style="font-size: 10px;">Industry</a> <a href="/tags/Information-Extraction/" style="font-size: 10px;">Information Extraction</a> <a href="/tags/Information-Theory/" style="font-size: 10px;">Information Theory</a> <a href="/tags/Isolation-Forest/" style="font-size: 10px;">Isolation Forest</a> <a href="/tags/ItemCF/" style="font-size: 10px;">ItemCF</a> <a href="/tags/Jaccard/" style="font-size: 10px;">Jaccard</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Jax/" style="font-size: 10px;">Jax</a> <a href="/tags/Job/" style="font-size: 10px;">Job</a> <a href="/tags/Jupyter/" style="font-size: 10px;">Jupyter</a> <a href="/tags/KKT/" style="font-size: 10px;">KKT</a> <a href="/tags/KS/" style="font-size: 10px;">KS</a> <a href="/tags/Kernel/" style="font-size: 10px;">Kernel</a> <a href="/tags/Kernel-Function/" style="font-size: 10px;">Kernel Function</a> <a href="/tags/Kernel-Method/" style="font-size: 10px;">Kernel Method</a> <a href="/tags/Keyword/" style="font-size: 10px;">Keyword</a> <a href="/tags/Knowledge-Graph/" style="font-size: 10.91px;">Knowledge Graph</a> <a href="/tags/LM/" style="font-size: 10.91px;">LM</a> <a href="/tags/LOF/" style="font-size: 10px;">LOF</a> <a href="/tags/LR/" style="font-size: 10px;">LR</a> <a href="/tags/LSTM/" style="font-size: 10px;">LSTM</a> <a href="/tags/Language-Model/" style="font-size: 10.91px;">Language Model</a> <a href="/tags/Lexical-Semantics/" style="font-size: 10px;">Lexical Semantics</a> <a href="/tags/Lexicalism/" style="font-size: 10px;">Lexicalism</a> <a href="/tags/Lexicalized-CFG/" style="font-size: 10px;">Lexicalized CFG</a> <a href="/tags/Lexicalized-Grammars/" style="font-size: 10px;">Lexicalized Grammars</a> <a href="/tags/Linear-Algebra/" style="font-size: 10px;">Linear Algebra</a> <a href="/tags/Linear-Sturcture/" style="font-size: 10px;">Linear Sturcture</a> <a href="/tags/Linked-List/" style="font-size: 10px;">Linked List</a> <a href="/tags/LinkedList/" style="font-size: 10.91px;">LinkedList</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Logistic-Regression/" style="font-size: 10px;">Logistic Regression</a> <a href="/tags/Lucene/" style="font-size: 10px;">Lucene</a> <a href="/tags/Luong-Attention/" style="font-size: 10px;">Luong Attention</a> <a href="/tags/MEMM/" style="font-size: 10px;">MEMM</a> <a href="/tags/MF/" style="font-size: 10px;">MF</a> <a href="/tags/Machine/" style="font-size: 10px;">Machine</a> <a href="/tags/Machine-Learning/" style="font-size: 14.55px;">Machine Learning</a> <a href="/tags/Machine-Translation/" style="font-size: 10px;">Machine Translation</a> <a href="/tags/Manacher/" style="font-size: 10px;">Manacher</a> <a href="/tags/Managemnt/" style="font-size: 11.82px;">Managemnt</a> <a href="/tags/Markov/" style="font-size: 10px;">Markov</a> <a href="/tags/Materialized-Views/" style="font-size: 10px;">Materialized Views</a> <a href="/tags/Math/" style="font-size: 10.91px;">Math</a> <a href="/tags/Matplotlib/" style="font-size: 10px;">Matplotlib</a> <a href="/tags/Matrix-Factorization/" style="font-size: 10px;">Matrix Factorization</a> <a href="/tags/Median/" style="font-size: 10px;">Median</a> <a href="/tags/Meta-Learning/" style="font-size: 10px;">Meta Learning</a> <a href="/tags/Metric/" style="font-size: 10px;">Metric</a> <a href="/tags/Minimum-Edit-Distance/" style="font-size: 10px;">Minimum Edit Distance</a> <a href="/tags/Minkowski/" style="font-size: 10px;">Minkowski</a> <a href="/tags/Model-Evaluation/" style="font-size: 10px;">Model Evaluation</a> <a href="/tags/Module/" style="font-size: 10px;">Module</a> <a href="/tags/Multi-Head-Attention/" style="font-size: 10px;">Multi-Head Attention</a> <a href="/tags/Multitask/" style="font-size: 10px;">Multitask</a> <a href="/tags/Multiway-Tree/" style="font-size: 10px;">Multiway Tree</a> <a href="/tags/NAT/" style="font-size: 10px;">NAT</a> <a href="/tags/NER/" style="font-size: 10.91px;">NER</a> <a href="/tags/NLG/" style="font-size: 10px;">NLG</a> <a href="/tags/NLM/" style="font-size: 10px;">NLM</a> <a href="/tags/NLP/" style="font-size: 20px;">NLP</a> <a href="/tags/NLU/" style="font-size: 10px;">NLU</a> <a href="/tags/NMT/" style="font-size: 10px;">NMT</a> <a href="/tags/Naive-Bayes/" style="font-size: 10px;">Naive Bayes</a> <a href="/tags/Neo4j/" style="font-size: 10px;">Neo4j</a> <a href="/tags/Network/" style="font-size: 10px;">Network</a> <a href="/tags/Ngram/" style="font-size: 10.91px;">Ngram</a> <a href="/tags/Normalizing-Flow/" style="font-size: 10px;">Normalizing Flow</a> <a href="/tags/NumPy/" style="font-size: 10px;">NumPy</a> <a href="/tags/Numba/" style="font-size: 10px;">Numba</a> <a href="/tags/Numpy/" style="font-size: 10px;">Numpy</a> <a href="/tags/Occupation/" style="font-size: 10px;">Occupation</a> <a href="/tags/Orientation/" style="font-size: 10px;">Orientation</a> <a href="/tags/P-R/" style="font-size: 10px;">P-R</a> <a href="/tags/PCCG/" style="font-size: 10px;">PCCG</a> <a href="/tags/PCFG/" style="font-size: 10px;">PCFG</a> <a href="/tags/PEGASUS/" style="font-size: 10px;">PEGASUS</a> <a href="/tags/PPMI/" style="font-size: 10px;">PPMI</a> <a href="/tags/PTM/" style="font-size: 10px;">PTM</a> <a href="/tags/PageRank/" style="font-size: 10px;">PageRank</a> <a href="/tags/Palindromic/" style="font-size: 10px;">Palindromic</a> <a href="/tags/Pandarallel/" style="font-size: 10px;">Pandarallel</a> <a href="/tags/Pandas/" style="font-size: 10.91px;">Pandas</a> <a href="/tags/Partial-Parsing/" style="font-size: 10px;">Partial Parsing</a> <a href="/tags/Pearson/" style="font-size: 10px;">Pearson</a> <a href="/tags/Philosophy/" style="font-size: 10.91px;">Philosophy</a> <a href="/tags/Phrase-Structure-Grammar/" style="font-size: 10px;">Phrase Structure Grammar</a> <a href="/tags/Phrase-Structure-Grammars/" style="font-size: 10px;">Phrase Structure Grammars</a> <a href="/tags/PoS/" style="font-size: 10px;">PoS</a> <a href="/tags/Polars/" style="font-size: 10px;">Polars</a> <a href="/tags/Pooling/" style="font-size: 10px;">Pooling</a> <a href="/tags/Position-Encoding/" style="font-size: 10px;">Position-Encoding</a> <a href="/tags/Postgres/" style="font-size: 10.91px;">Postgres</a> <a href="/tags/Pragmatic-Automatic-Processing/" style="font-size: 10px;">Pragmatic Automatic Processing</a> <a href="/tags/Pre-Trained/" style="font-size: 10px;">Pre-Trained</a> <a href="/tags/Pre-Training/" style="font-size: 10px;">Pre-Training</a> <a href="/tags/Pre-training/" style="font-size: 10.91px;">Pre-training</a> <a href="/tags/Precision/" style="font-size: 10px;">Precision</a> <a href="/tags/Pretrain/" style="font-size: 10px;">Pretrain</a> <a href="/tags/Pretrained/" style="font-size: 10px;">Pretrained</a> <a href="/tags/Pretraining/" style="font-size: 10.91px;">Pretraining</a> <a href="/tags/Probabilistic-Grammar/" style="font-size: 10px;">Probabilistic Grammar</a> <a href="/tags/Probabilistic-Model/" style="font-size: 10px;">Probabilistic Model</a> <a href="/tags/Promote/" style="font-size: 10px;">Promote</a> <a href="/tags/Prompt/" style="font-size: 10px;">Prompt</a> <a href="/tags/ProtoBERT/" style="font-size: 10px;">ProtoBERT</a> <a href="/tags/Pruning/" style="font-size: 10px;">Pruning</a> <a href="/tags/Psychology/" style="font-size: 10.91px;">Psychology</a> <a href="/tags/PyPI/" style="font-size: 10px;">PyPI</a> <a href="/tags/Python/" style="font-size: 18.18px;">Python</a> <a href="/tags/Quant/" style="font-size: 10px;">Quant</a> <a href="/tags/Quantization/" style="font-size: 10px;">Quantization</a> <a href="/tags/Query/" style="font-size: 10px;">Query</a> <a href="/tags/Queue/" style="font-size: 10px;">Queue</a> <a href="/tags/R-Drop/" style="font-size: 10.91px;">R-Drop</a> <a href="/tags/RELU/" style="font-size: 10px;">RELU</a> <a href="/tags/RFE/" style="font-size: 10px;">RFE</a> <a href="/tags/RMSE/" style="font-size: 10px;">RMSE</a> <a href="/tags/RNN/" style="font-size: 10px;">RNN</a> <a href="/tags/ROC/" style="font-size: 10px;">ROC</a> <a href="/tags/RaspberryPi/" style="font-size: 10.91px;">RaspberryPi</a> <a href="/tags/Raspberrypi/" style="font-size: 10px;">Raspberrypi</a> <a href="/tags/Recall/" style="font-size: 10px;">Recall</a> <a href="/tags/Recommendation/" style="font-size: 13.64px;">Recommendation</a> <a href="/tags/Recursion/" style="font-size: 10.91px;">Recursion</a> <a href="/tags/Reformer/" style="font-size: 10px;">Reformer</a> <a href="/tags/Regex/" style="font-size: 10px;">Regex</a> <a href="/tags/Regular-Expression/" style="font-size: 10px;">Regular Expression</a> <a href="/tags/Reinforcement-Learning/" style="font-size: 10px;">Reinforcement Learning</a> <a href="/tags/Relationship-Extraction/" style="font-size: 10px;">Relationship Extraction</a> <a href="/tags/Representation/" style="font-size: 10.91px;">Representation</a> <a href="/tags/Reqular-Expressions/" style="font-size: 10px;">Reqular Expressions</a> <a href="/tags/RoBERTa/" style="font-size: 10px;">RoBERTa</a> <a href="/tags/Rotated-Sorted-Array/" style="font-size: 10px;">Rotated Sorted Array</a> <a href="/tags/Rust/" style="font-size: 15.45px;">Rust</a> <a href="/tags/SCFG/" style="font-size: 10px;">SCFG</a> <a href="/tags/SGD/" style="font-size: 10px;">SGD</a> <a href="/tags/SMO/" style="font-size: 10px;">SMO</a> <a href="/tags/SQL/" style="font-size: 10.91px;">SQL</a> <a href="/tags/SRN/" style="font-size: 10px;">SRN</a> <a href="/tags/SVD/" style="font-size: 10px;">SVD++</a> <a href="/tags/SVM/" style="font-size: 10.91px;">SVM</a> <a href="/tags/Seaborn/" style="font-size: 10px;">Seaborn</a> <a href="/tags/Search/" style="font-size: 10.91px;">Search</a> <a href="/tags/Segmentation/" style="font-size: 10px;">Segmentation</a> <a href="/tags/Self-Attention/" style="font-size: 11.82px;">Self-Attention</a> <a href="/tags/Semantic-Automatic-Processing/" style="font-size: 10px;">Semantic Automatic Processing</a> <a href="/tags/Semantic-Similarity/" style="font-size: 10px;">Semantic Similarity</a> <a href="/tags/Senta/" style="font-size: 10px;">Senta</a> <a href="/tags/Sentence-Similarity/" style="font-size: 10px;">Sentence Similarity</a> <a href="/tags/Sentence-BERT/" style="font-size: 10px;">Sentence-BERT</a> <a href="/tags/Sentiment-Classification/" style="font-size: 10px;">Sentiment Classification</a> <a href="/tags/SentimentAnalysis/" style="font-size: 10px;">SentimentAnalysis</a> <a href="/tags/Siamese/" style="font-size: 10px;">Siamese</a> <a href="/tags/Sigmoid/" style="font-size: 10px;">Sigmoid</a> <a href="/tags/SimCSE/" style="font-size: 10.91px;">SimCSE</a> <a href="/tags/Similarity/" style="font-size: 10px;">Similarity</a> <a href="/tags/Simon/" style="font-size: 10px;">Simon</a> <a href="/tags/Simpson-Paradox/" style="font-size: 10px;">Simpson Paradox</a> <a href="/tags/Skill/" style="font-size: 10px;">Skill</a> <a href="/tags/Slide/" style="font-size: 10px;">Slide</a> <a href="/tags/Smoothing/" style="font-size: 10.91px;">Smoothing</a> <a href="/tags/Soft-SVM/" style="font-size: 10px;">Soft-SVM</a> <a href="/tags/Softmax/" style="font-size: 10px;">Softmax</a> <a href="/tags/Sort/" style="font-size: 10.91px;">Sort</a> <a href="/tags/Spell-Check/" style="font-size: 10px;">Spell Check</a> <a href="/tags/SqueezeBERT/" style="font-size: 10px;">SqueezeBERT</a> <a href="/tags/Stack/" style="font-size: 10px;">Stack</a> <a href="/tags/Stacking/" style="font-size: 10px;">Stacking</a> <a href="/tags/Statistics/" style="font-size: 10px;">Statistics</a> <a href="/tags/Stirling/" style="font-size: 10px;">Stirling</a> <a href="/tags/StratifiedKFold/" style="font-size: 10px;">StratifiedKFold</a> <a href="/tags/String/" style="font-size: 10.91px;">String</a> <a href="/tags/Style/" style="font-size: 10px;">Style</a> <a href="/tags/Substring/" style="font-size: 10px;">Substring</a> <a href="/tags/Summarization/" style="font-size: 10px;">Summarization</a> <a href="/tags/Supertagging/" style="font-size: 10px;">Supertagging</a> <a href="/tags/Swap/" style="font-size: 10px;">Swap</a> <a href="/tags/System/" style="font-size: 10.91px;">System</a> <a href="/tags/TF-IDF/" style="font-size: 10px;">TF-IDF</a> <a href="/tags/Tagging/" style="font-size: 10px;">Tagging</a> <a href="/tags/TanH/" style="font-size: 10px;">TanH</a> <a href="/tags/TensorBay/" style="font-size: 10px;">TensorBay</a> <a href="/tags/Tensorflow/" style="font-size: 10px;">Tensorflow</a> <a href="/tags/Test/" style="font-size: 10px;">Test</a> <a href="/tags/Text-Classification/" style="font-size: 10px;">Text Classification</a> <a href="/tags/Text-Generation/" style="font-size: 10px;">Text Generation</a> <a href="/tags/Text-Normalization/" style="font-size: 10px;">Text Normalization</a> <a href="/tags/TextCNN/" style="font-size: 10.91px;">TextCNN</a> <a href="/tags/TextRank/" style="font-size: 10px;">TextRank</a> <a href="/tags/Thought/" style="font-size: 10px;">Thought</a> <a href="/tags/Transformer/" style="font-size: 17.27px;">Transformer</a> <a href="/tags/Transformer-XL/" style="font-size: 10px;">Transformer-XL</a> <a href="/tags/Tree/" style="font-size: 10px;">Tree</a> <a href="/tags/Treebank/" style="font-size: 10px;">Treebank</a> <a href="/tags/Tuning/" style="font-size: 10px;">Tuning</a> <a href="/tags/Tutorial/" style="font-size: 10px;">Tutorial</a> <a href="/tags/Ubuntu/" style="font-size: 10px;">Ubuntu</a> <a href="/tags/UniLM/" style="font-size: 10px;">UniLM</a> <a href="/tags/Unity-Operation/" style="font-size: 10px;">Unity Operation</a> <a href="/tags/Unix/" style="font-size: 10px;">Unix</a> <a href="/tags/UserCF/" style="font-size: 10px;">UserCF</a> <a href="/tags/Vagrant/" style="font-size: 10px;">Vagrant</a> <a href="/tags/Valence/" style="font-size: 10px;">Valence</a> <a href="/tags/Vector-Semantics/" style="font-size: 10px;">Vector Semantics</a> <a href="/tags/Virtual-Network/" style="font-size: 10px;">Virtual Network</a> <a href="/tags/VirtualBox/" style="font-size: 10px;">VirtualBox</a> <a href="/tags/Visualization/" style="font-size: 10px;">Visualization</a> <a href="/tags/Viterbi/" style="font-size: 10.91px;">Viterbi</a> <a href="/tags/Vocabulary-Learning/" style="font-size: 10px;">Vocabulary Learning</a> <a href="/tags/Voting/" style="font-size: 10px;">Voting</a> <a href="/tags/WOE/" style="font-size: 10px;">WOE</a> <a href="/tags/Web-Server-Multithreaded-Server/" style="font-size: 10px;">Web Server Multithreaded Server</a> <a href="/tags/Wide/" style="font-size: 10px;">Wide</a> <a href="/tags/Word2vec/" style="font-size: 10px;">Word2vec</a> <a href="/tags/Work/" style="font-size: 10px;">Work</a> <a href="/tags/XLNet/" style="font-size: 10px;">XLNet</a> <a href="/tags/Z-Score/" style="font-size: 10px;">Z-Score</a> <a href="/tags/Zero-shot/" style="font-size: 10px;">Zero-shot</a> <a href="/tags/ZhouZhihua/" style="font-size: 10px;">ZhouZhihua</a> <a href="/tags/Zipf/" style="font-size: 10px;">Zipf</a> <a href="/tags/binning/" style="font-size: 10px;">binning</a> <a href="/tags/few-shot/" style="font-size: 10px;">few-shot</a> <a href="/tags/ffmpeg/" style="font-size: 10px;">ffmpeg</a> <a href="/tags/jpype/" style="font-size: 10px;">jpype</a> <a href="/tags/knowledge-Graph/" style="font-size: 10px;">knowledge Graph</a> <a href="/tags/motion/" style="font-size: 10px;">motion</a> <a href="/tags/node2vec/" style="font-size: 10px;">node2vec</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/str/" style="font-size: 10px;">str</a> <a href="/tags/vlc/" style="font-size: 10px;">vlc</a>
    </div>
  </aside>

  
</div>
      </div>
      <footer id="colophon" role="contentinfo">
    <p>&copy; 2021 Yam
    All rights reserved.</p>
    <p>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></p>
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <!-- <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span> -->
    <!-- <span id="busuanzi_container_page_pv">本文总阅读量<span id="busuanzi_value_page_pv"></span>次</span> -->
    <!-- <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span> -->

</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

<script src="/js/navigation.js"></script>

<div id="bg"></div>

  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>